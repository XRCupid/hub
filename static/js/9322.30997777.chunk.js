"use strict";(self.webpackChunkhub=self.webpackChunkhub||[]).push([[9322],{59322:(e,r,t)=>{t.r(r),t.d(r,{SimpleUserAvatarPiP:()=>u});var n=t(65043),a=t(71985),s=t(50007),i=t(39581),c=t(25021),o=(t(30971),t(70579));class l extends n.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,r){console.error("Canvas error:",e,r)}render(){var e;return this.state.hasError?(0,o.jsxs)("div",{style:{padding:"20px",color:"red"},children:[(0,o.jsx)("h3",{children:"Rendering Error"}),(0,o.jsx)("p",{children:null===(e=this.state.error)||void 0===e?void 0:e.message}),(0,o.jsx)("button",{onClick:()=>window.location.reload(),children:"Reload"})]}):this.props.children}}const d=(0,n.memo)((e=>{let{avatarUrl:r,trackingData:t}=e;return console.log("[AvatarCanvas] Rendering"),(0,o.jsxs)(a.Hl,{camera:{position:[0,1.5,2],fov:28,near:.1,far:100},style:{width:"100%",height:"100%"},gl:{preserveDrawingBuffer:!0},children:[(0,o.jsx)("ambientLight",{intensity:.6}),(0,o.jsx)("directionalLight",{position:[0,10,5],intensity:.8}),(0,o.jsx)("directionalLight",{position:[0,5,10],intensity:.5}),(0,o.jsx)(n.Suspense,{fallback:null,children:(0,o.jsx)(i.PresenceAvatar,{avatarUrl:r,trackingData:t,position:[0,0,0],scale:1})}),(0,o.jsx)(s.N,{enablePan:!1,enableZoom:!1,enableRotate:!1,target:[0,1.5,0]})]})})),u=e=>{let{avatarUrl:r="/avatars/coach_grace.glb",onClose:t,position:a="bottom-right",size:s="medium"}=e;const[i,u]=(0,n.useState)(!1),[h,p]=(0,n.useState)(null),[x,g]=(0,n.useState)(!1),[m,v]=(0,n.useState)(""),j=(0,n.useRef)(null),b=(0,n.useRef)(null),f=(0,n.useRef)(null);(0,n.useEffect)((()=>((async()=>{try{b.current||(b.current=new c.L,await b.current.initialize());const e=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},facingMode:"user"}});j.current&&(j.current.srcObject=e,await j.current.play())}catch(e){console.error("Failed to initialize:",e),v("Failed to access camera")}})(),()=>{var e;if(k(),null!==(e=j.current)&&void 0!==e&&e.srcObject){j.current.srcObject.getTracks().forEach((e=>e.stop()))}})),[]);const k=()=>{f.current&&(clearInterval(f.current),f.current=null),b.current&&b.current.stopTracking(),u(!1)};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("video",{ref:j,style:{display:"none"},playsInline:!0,muted:!0}),(0,o.jsxs)("div",{className:"user-avatar-pip ".concat(a," ").concat(s," ").concat(x?"minimized":""),children:[(0,o.jsxs)("div",{className:"pip-controls",children:[(0,o.jsx)("button",{className:"pip-button",onClick:()=>g(!x),title:x?"Restore":"Minimize",children:x?"\u25a1":"_"}),t&&(0,o.jsx)("button",{className:"pip-button",onClick:t,title:"Close",children:"\xd7"})]}),!x&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"pip-content",children:[(0,o.jsx)(l,{children:(0,o.jsx)(d,{avatarUrl:r,trackingData:h})}),m&&(0,o.jsxs)("div",{className:"error-message",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0,0,0,0.8)",padding:"20px",borderRadius:"8px"},children:[(0,o.jsx)("p",{children:m}),(0,o.jsx)("button",{onClick:()=>window.location.reload(),children:"Refresh"})]})]},"avatar-canvas-container"),(0,o.jsx)("div",{className:"pip-footer",children:i?(0,o.jsx)("button",{onClick:k,className:"control-button active",children:"Stop Tracking"}):(0,o.jsx)("button",{onClick:async()=>{if(b.current&&j.current){u(!0),v("");try{await b.current.startTracking(j.current),f.current=setInterval((()=>{if(b.current){const e=b.current.getExpressions(),r=b.current.getHeadRotation(),t=b.current.getLandmarks();p({facialExpressions:e,headRotation:r,posture:null,hands:null,landmarks:t||[]})}}),33)}catch(e){console.error("Tracking error:",e),v(e.message||"Failed to start tracking"),u(!1)}}},className:"control-button",children:"Start Camera & Tracking"})})]}),(null===h||void 0===h?void 0:h.facialExpressions)&&!m&&(0,o.jsx)("div",{className:"expression-debug",children:(0,o.jsxs)("div",{className:"expression-mini",children:[i&&(0,o.jsx)("div",{style:{color:"lime",fontSize:"10px"},children:"\u25cf TRACKING"}),Object.entries(h.facialExpressions).filter((e=>{let[r,t]=e;return t>.2})).slice(0,3).map((e=>{let[r,t]=e;return(0,o.jsxs)("div",{style:{fontSize:"10px"},children:[r,": ",(100*t).toFixed(0),"%"]},r)}))]})})]})]})}}}]);
//# sourceMappingURL=9322.30997777.chunk.js.map