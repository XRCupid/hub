"use strict";(self.webpackChunkhub=self.webpackChunkhub||[]).push([[9586],{69586:(e,t,n)=>{n.r(t),n.d(t,{default:()=>c});var o=n(89379),r=n(9950),a=n(12880),s=n(99996),i=n(44414);const l={neutral:{eyeBlinkLeft:.1,eyeBlinkRight:.1,browInnerUp:0,browDownLeft:0,browDownRight:0,jawOpen:0,mouthSmileLeft:0,mouthSmileRight:0,mouthFrownLeft:0,mouthFrownRight:0,cheekPuffLeft:0,cheekPuffRight:0},happy:{eyeBlinkLeft:.05,eyeBlinkRight:.05,mouthSmileLeft:.8,mouthSmileRight:.8,browInnerUp:.4,jawOpen:.2,cheekPuffLeft:.3,cheekPuffRight:.3},sad:{eyeBlinkLeft:.5,eyeBlinkRight:.5,mouthFrownLeft:.7,mouthFrownRight:.7,browDownLeft:.6,browDownRight:.6,jawOpen:.3,cheekPuffLeft:.1,cheekPuffRight:.1},surprised:{eyeWideLeft:.7,eyeWideRight:.7,jawOpen:.7,browInnerUp:.8,mouthOpen:.5,cheekPuffLeft:.2,cheekPuffRight:.2},angry:{browDownLeft:.8,browDownRight:.8,mouthPressLeft:.6,mouthPressRight:.6,eyeBlinkLeft:.4,eyeBlinkRight:.4,jawOpen:.3,mouthFrownLeft:.5,mouthFrownRight:.5}},c=e=>{let{type:t="coach",avatarUrl:n="https://models.readyplayer.me/681d6cd903879b2f11528470.glb",ttsApiKey:c=null,gazeWander:h=!1,textToSpeak:u=""}=e;console.log("[DEBUG] SimulationAvatar mounted");const[f,m]=(0,r.useState)("neutral"),[d,g]=(0,r.useState)({}),[p,w]=((0,r.useRef)(null),(0,r.useState)(!1)),y=(0,r.useRef)(null);(0,r.useEffect)((()=>{if(!u||"undefined"===typeof window||!window.speechSynthesis)return;y.current&&(window.speechSynthesis.cancel(),y.current=null);const e=new window.SpeechSynthesisUtterance(u);return e.onstart=()=>w(!0),e.onend=()=>w(!1),e.onerror=()=>w(!1),y.current=e,window.speechSynthesis.speak(e),()=>{y.current&&(window.speechSynthesis.cancel(),y.current=null)}}),[u]);const k=(0,r.useRef)(null),L=(0,r.useRef)(null),[R,b]=(0,r.useState)({horizontal:0,vertical:0}),M=(0,r.useRef)({horizontal:0,vertical:0}),D=(0,r.useRef)(null);return(0,r.useEffect)((()=>{if(!h)return;let e=!0;return function t(){e&&(b({horizontal:.4*(Math.random()-.5),vertical:.2*(Math.random()-.5)}),D.current=setTimeout(t,1e3+1e3*Math.random()))}(),()=>{e=!1,D.current&&clearTimeout(D.current)}}),[h]),(0,r.useEffect)((()=>{let e,t,n=!1,r=0,a=1,s=Math.random()*Math.PI*2;function i(){if(r+=.2*a,r>=1)r=1,a=-1;else if(r<=0)return r=0,a=1,n=!1,void c();u(),e=setTimeout(i,40)}function c(){const t=2500+2500*Math.random();e=setTimeout((()=>{n=!0,a=1,i()}),t)}function u(){const e=l[f]||l.neutral,t={};for(const n in e)n.startsWith("mouth")||n.startsWith("brow")||n.startsWith("cheek")||n.startsWith("eye")||n.startsWith("nose")?t[n]=Math.min(1,3*(e[n]||0)):t[n]=e[n];let a=t.jawOpen||0;if(p){const e=performance.now()/1e3;a=.3+.2*Math.abs(Math.sin(6*e+s))}const i=n?r:t.eyeBlinkLeft||0,c=n?r:t.eyeBlinkRight||0;let u=t.eyeLookInLeft||0,m=t.eyeLookOutLeft||0,d=t.eyeLookUpLeft||0,w=t.eyeLookDownLeft||0,y=t.eyeLookInRight||0,k=t.eyeLookOutRight||0,L=t.eyeLookUpRight||0,b=t.eyeLookDownRight||0;if(h){const e=(e,t,n)=>e+(t-e)*n;M.current.horizontal=e(M.current.horizontal,R.horizontal,.07),M.current.vertical=e(M.current.vertical,R.vertical,.07),u=Math.max(0,-M.current.horizontal),m=Math.max(0,M.current.horizontal),y=Math.max(0,M.current.horizontal),k=Math.max(0,-M.current.horizontal),d=Math.max(0,M.current.vertical),w=Math.max(0,-M.current.vertical),L=Math.max(0,M.current.vertical),b=Math.max(0,-M.current.vertical)}const D=(0,o.A)((0,o.A)({},t),{},{jawOpen:a,eyeBlinkLeft:i,eyeBlinkRight:c,eyeLookInLeft:u,eyeLookOutLeft:m,eyeLookUpLeft:d,eyeLookDownLeft:w,eyeLookInRight:y,eyeLookOutRight:k,eyeLookUpRight:L,eyeLookDownRight:b});console.log("[EMOTION DEBUG] Amplified blendShapes:",D),g(D)}return c(),function e(){u(),t=requestAnimationFrame(e)}(),()=>{clearTimeout(e),cancelAnimationFrame(t)}}),[f,p]),(0,r.useEffect)((()=>{(async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new AudioContext,n=t.createAnalyser();t.createMediaStreamSource(e).connect(n);const o=()=>{const e=n.frequencyBinCount,t=new Uint8Array(e);n.getByteFrequencyData(t);const r=t.reduce(((e,t)=>e+t))/e;w(r>10),requestAnimationFrame(o)};o()}catch(e){console.error("Audio capture error:",e)}})()}),[]),(0,a.F)((()=>{if(!L.current)return void(Math.random()<.01&&console.warn("[DEBUG][useFrame] morphMeshRef.current is NOT set"));const e=L.current.morphTargetDictionary,t=L.current.morphTargetInfluences;e&&t&&d&&(Math.random()<.01&&(console.log("[DEBUG][useFrame] Updating mesh:",L.current.name),console.log("[DEBUG][useFrame] BlendShapes:",d),console.log("[DEBUG][useFrame] morphTargetInfluences (before):",[...t])),Object.entries(d).forEach((n=>{let[o,r]=n;const a=e[o];void 0!==a&&(t[a]=r)})),Math.random()<.01&&console.log("[DEBUG][useFrame] morphTargetInfluences (after):",[...t]))})),(0,i.jsxs)("div",{className:"simulation-avatar",children:[console.log("Rendering Avatar component"),(0,i.jsx)(s.eu,{ref:k,modelSrc:n,blendShapes:d,environment:"sunset",onModelLoaded:e=>{if(console.log("Model loaded!",e),console.log("Avatar model loaded:",e),e&&e.scene?e.scene.traverse((e=>{e.isMesh&&e.morphTargetDictionary&&(console.log("[DEBUG] Mesh:",e.name),console.log("[DEBUG] Morph Target Names:",Object.keys(e.morphTargetDictionary)),L.current||(L.current=e,console.log("[DEBUG][onModelLoaded] morphMeshRef set to:",e.name)))})):console.warn("[DEBUG] Model or scene missing for morph target inspection"),e&&e.userData){if(console.group("Avatar Model Debug"),console.log("Model Source:",n),e.userData.blendShapes){console.log("Available Blendshape Names:",Object.keys(e.userData.blendShapes)),console.log("Blendshape Values:",e.userData.blendShapes),0===Object.keys(d).length&&console.warn("WARNING: No blendshapes are being applied to the avatar!");const t=["eyeBlinkLeft","eyeBlinkRight","jawOpen","mouthSmileLeft","mouthSmileRight","mouthFrownLeft","mouthFrownRight","browInnerUp","browDownLeft","browDownRight","cheekPuffLeft","cheekPuffRight"].filter((t=>!Object.keys(e.userData.blendShapes).includes(t)));t.length>0&&console.warn("Missing expected blendshapes:",t)}else console.warn("No blendshapes found in model.userData");e.scene&&(console.log("Scene Children:",e.scene.children.length),e.scene.traverse((e=>{e.isMesh&&(console.log("Mesh:",e.name),e.morphTargetDictionary&&console.log("Morphtarget Dictionary:",Object.keys(e.morphTargetDictionary)),e.morphTargetInfluences&&console.log("Morphtarget Influences:",e.morphTargetInfluences))}))),console.groupEnd()}else console.warn("Model or userData is undefined")}}),(0,i.jsxs)("div",{className:"avatar-controls",children:[(0,i.jsx)("select",{value:f,onChange:e=>m(e.target.value),children:Object.keys(l).map((e=>(0,i.jsx)("option",{value:e,children:e},e)))}),(0,i.jsxs)("div",{style:{fontSize:"0.9em",color:"#888"},children:["Gaze wander: ",h?"On":"Off"]}),(0,i.jsxs)("div",{className:"avatar-info",children:[(0,i.jsxs)("p",{children:["Character Type: ",t]}),(0,i.jsxs)("p",{children:["Speaking: ",p?"Yes":"No"]}),(0,i.jsxs)("p",{children:["Current Emotion: ",f]})]})]})]})}}}]);