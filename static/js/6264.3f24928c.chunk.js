"use strict";(self.webpackChunkhub=self.webpackChunkhub||[]).push([[6264],{6264:(e,n,r)=>{r.r(n),r.d(n,{default:()=>d});var t=r(65043),o=r(79183),i=r(71985),c=r(81597),s=r(50007),u=r(29408),l=r(70579);function a(e){let{postureData:n}=e;const r=(0,t.useRef)(null),{scene:i}=(0,c.p)("/avatars/AngelChick.glb"),{animations:s}=(0,c.p)("/animations/feminine/idle/F_Standing_Idle_001.glb"),a=(0,t.useRef)(null),f=(0,t.useRef)(null),d=(0,t.useRef)(null),h=(0,t.useRef)(null),p=(0,t.useRef)(null),g=(0,t.useRef)(null),m=(0,t.useRef)(null),b=(0,t.useRef)({});return(0,t.useEffect)((()=>{i&&(i.traverse((e=>{if(e instanceof u.Bone){const n=e.name.toLowerCase();n.includes("head")?(f.current=e,b.current.head=e.quaternion.clone()):n.includes("neck")?(d.current=e,b.current.neck=e.quaternion.clone()):n.includes("leftarm")||n.includes("left_arm")||n.includes("l_arm")?n.includes("forearm")||n.includes("fore")?(g.current=e,b.current.leftForeArm=e.quaternion.clone()):(h.current=e,b.current.leftArm=e.quaternion.clone()):(n.includes("rightarm")||n.includes("right_arm")||n.includes("r_arm"))&&(n.includes("forearm")||n.includes("fore")?(m.current=e,b.current.rightForeArm=e.quaternion.clone()):(p.current=e,b.current.rightArm=e.quaternion.clone()))}})),r.current&&(r.current.clear(),r.current.add(i)))}),[i]),(0,t.useEffect)((()=>{if(i&&s&&s.length>0){const e=new u.AnimationMixer(i);a.current=e;const n=e.clipAction(s[0]);n.reset(),n.setLoop(u.LoopRepeat,1/0),n.play()}}),[i,s]),(0,o.F)(((e,r)=>{if(a.current&&a.current.update(r),!n||!n.keypoints)return;const t=n.keypoints;if(t.nose&&t.nose.confidence>.3&&f.current){const e=new u.Euler(.5*(t.nose.y-.5),.5*-(t.nose.x-.5),0);f.current.quaternion.setFromEuler(e)}const o=(e,n,r,t,o,i)=>{if(!t||!e||!n||!r)return;if(e.confidence<.3||n.confidence<.3||r.confidence<.3)return;const c=new u.Vector3(2*(e.x/640-.5),2*-(e.y/480-.5),0),s=new u.Vector3(2*(n.x/640-.5),2*-(n.y/480-.5),-.15),l=new u.Vector3(2*(r.x/640-.5),2*-(r.y/480-.5),-.3),a=l.clone().sub(c).normalize(),f=i?new u.Vector3(-1,0,0):new u.Vector3(1,0,0),d=new u.Quaternion;if(d.setFromUnitVectors(f,a),t.quaternion.copy(d),o){const e=l.clone().sub(s).normalize(),n=s.clone().sub(c).normalize().angleTo(e),r=new u.Quaternion;r.setFromAxisAngle(new u.Vector3(0,0,i?-1:1),.5*n),o.quaternion.copy(b.current[i?"leftForeArm":"rightForeArm"]),o.quaternion.multiply(r)}};t.leftShoulder&&t.leftElbow&&t.leftWrist&&o(t.leftShoulder,t.leftElbow,t.leftWrist,h.current,g.current,!0),t.rightShoulder&&t.rightElbow&&t.rightWrist&&o(t.rightShoulder,t.rightElbow,t.rightWrist,p.current,m.current,!1)})),(0,l.jsx)("group",{ref:r,scale:100,position:[0,-100,0]})}function f(e){let{onPoseData:n}=e;const r=(0,t.useRef)(null);return(0,t.useEffect)((()=>{(async()=>{try{const e=await navigator.mediaDevices.getUserMedia({video:{width:640,height:480}});r.current&&(r.current.srcObject=e,await r.current.play())}catch(e){console.error("Error accessing webcam:",e)}})();return setTimeout((async()=>{if("undefined"!==typeof ml5){ml5.poseNet(r.current,(()=>{console.log("PoseNet loaded")})).on("pose",(e=>{if(e.length>0){const r=e[0].pose,t={};r.keypoints.forEach((e=>{t[e.part]={x:e.position.x,y:e.position.y,confidence:e.score}})),n({keypoints:t,confidence:r.score})}}))}}),1e3),()=>{if(r.current&&r.current.srcObject){r.current.srcObject.getTracks().forEach((e=>e.stop()))}}}),[n]),(0,l.jsx)("video",{ref:r,style:{position:"absolute",bottom:20,right:20,width:320,height:240,transform:"scaleX(-1)",borderRadius:"10px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)"}})}function d(){const[e,n]=(0,t.useState)(null);return(0,l.jsxs)("div",{style:{width:"100vw",height:"100vh",position:"relative"},children:[(0,l.jsxs)(i.Hl,{camera:{position:[0,100,300],fov:50},children:[(0,l.jsx)("ambientLight",{intensity:.6}),(0,l.jsx)("directionalLight",{position:[10,10,5],intensity:1}),(0,l.jsx)(t.Suspense,{fallback:null,children:(0,l.jsx)(a,{postureData:e})}),(0,l.jsx)(s.N,{}),(0,l.jsx)("gridHelper",{args:[500,50]})]}),(0,l.jsx)(f,{onPoseData:n})]})}c.p.preload("/avatars/AngelChick.glb"),c.p.preload("/animations/feminine/idle/F_Standing_Idle_001.glb")}}]);
//# sourceMappingURL=6264.3f24928c.chunk.js.map