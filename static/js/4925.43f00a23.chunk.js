"use strict";(self.webpackChunkhub=self.webpackChunkhub||[]).push([[4925],{84925:(e,r,s)=>{s.r(r),s.d(r,{RPMConfiguredAvatar:()=>p});var t=s(65043),a=s(79183),o=s(84718),n=s(29408),c=s(9942),l=s(38453),i=s(51066),u=s(70579);const h=e=>{let{url:r,blendShapes:s,position:c=[0,0,0],scale:l=1}=e;const i=(0,a.H)(o.B,r),h=(0,t.useRef)(null),d=(0,t.useRef)(null);return(0,t.useEffect)((()=>{if(i&&h.current){if(i.animations&&i.animations.length>0){d.current=new n.AnimationMixer(h.current);d.current.clipAction(i.animations[0]).play()}h.current.traverse((e=>{e instanceof n.SkinnedMesh&&(e.frustumCulled=!1,e.morphTargetDictionary&&e.morphTargetInfluences&&s&&Object.entries(s).forEach((r=>{let[s,t]=r;const a=e.morphTargetDictionary[s];void 0!==a&&(e.morphTargetInfluences[a]=t)})))}))}}),[i,s]),(0,a.F)(((e,r)=>{d.current&&d.current.update(r)})),(0,u.jsx)("primitive",{ref:h,object:i.scene,position:c,scale:l})};class d extends t.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}render(){return this.state.hasError?this.props.fallback:this.props.children}}const p=e=>{let{avatarUrl:r,blendShapes:s,position:n=[0,0,0],scale:p=1,fallbackComponent:m}=e;const[f,b]=(0,t.useState)(""),[x,g]=(0,t.useState)(!0),[y,j]=(0,t.useState)(null),{gl:S}=(0,a.D)();(0,t.useEffect)((()=>{r&&(async()=>{try{g(!0),j(null);let e="";if(r.includes("models.readyplayer.me")){const s=r.match(/models\.readyplayer\.me\/([^\/]+)\.glb/);s&&(e=s[1])}else if(r.includes("readyplayer.me/")){const s=r.match(/readyplayer\.me\/([^\/\?]+)/);s&&(e=s[1])}else e=r.replace(".glb","");if(!e)throw new Error("Invalid avatar URL or ID");const s=new URLSearchParams({morphTargets:"ARKit,Oculus Visemes",textureAtlas:"1024",pose:"T",lod:"0",useHands:"true",meshCompression:"false"}),t="https://models.readyplayer.me/".concat(e,".glb?").concat(s.toString()),a=await fetch(t,{method:"HEAD"});if(!a.ok)throw new Error("Avatar not accessible: ".concat(a.status));b(t),g(!1)}catch(e){console.error("Error processing avatar URL:",e),j(e instanceof Error?e.message:"Failed to load avatar"),g(!1)}})()}),[r]);const w=(0,u.jsxs)("mesh",{position:n,scale:p,children:[(0,u.jsx)("boxGeometry",{args:[1,2,.5]}),(0,u.jsx)("meshStandardMaterial",{color:"#4A90E2"})]});if(x)return(0,u.jsxs)("mesh",{position:n,scale:p,children:[(0,u.jsx)("boxGeometry",{args:[1,2,.5]}),(0,u.jsx)("meshStandardMaterial",{color:"#cccccc",wireframe:!0})]});if(y||!f)return console.error("RPM Avatar Error:",y),(0,u.jsx)(u.Fragment,{children:m||w});const E=new o.B,v=new c.p;v.setTranscoderPath("/basis/"),v.detectSupport(S),E.setKTX2Loader(v);const k=new l.Z;return k.setDecoderPath("/draco/"),E.setDRACOLoader(k),E.setMeshoptDecoder(i.f),(0,u.jsx)(d,{fallback:m||w,children:(0,u.jsx)(t.Suspense,{fallback:(0,u.jsxs)("mesh",{position:n,scale:p,children:[(0,u.jsx)("boxGeometry",{args:[1,2,.5]}),(0,u.jsx)("meshStandardMaterial",{color:"#cccccc",wireframe:!0})]}),children:(0,u.jsx)(h,{url:f,blendShapes:s,position:n,scale:p})})})}}}]);
//# sourceMappingURL=4925.43f00a23.chunk.js.map