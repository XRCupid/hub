"use strict";(self.webpackChunkhub=self.webpackChunkhub||[]).push([[770,3807],{20770:(e,t,r)=>{r.r(t),r.d(t,{RPMAvatarWithTracking:()=>u});var n=r(89379),a=r(65043),o=r(81597),i=r(5355),s=r(79183),c=r(29408),l=r(70579);const u=e=>{let{avatarUrl:t,animationUrl:r,position:u=[0,-.4,0],rotation:h=[0,0,0],scale:p=[1.2,1.2,1.2],enableWebcamTracking:m=!1,headRotation:f={pitch:0,yaw:0,roll:0},expressions:g={},visemes:y={},isSpeaking:d=!1,voiceIntensity:v=0,emotionalState:b="neutral"}=e;const{scene:w}=(0,o.p)(t),T=(0,o.p)(r||t),k=r?T.animations:[],{actions:I}=(0,i.f)(k,w),S=(0,a.useRef)(null),D=(0,a.useRef)(null),M=(0,a.useRef)({}),R={pitch:0,yaw:0,roll:0},E=!1,x=null;return(0,a.useEffect)((()=>{m&&(console.log("Webcam tracking enabled:",E),x&&console.error("Webcam error:",x))}),[m,E,x]),(0,a.useEffect)((()=>{w&&w.traverse((e=>{if(e instanceof c.Bone){const t=e.name.toLowerCase();t.includes("head")?S.current=e:t.includes("neck")&&(D.current=e)}e instanceof c.SkinnedMesh&&e.morphTargetDictionary&&(M.current[e.name]=e)}))}),[w]),(0,a.useEffect)((()=>{if(I&&k.length>0){var e;const t=k.find((e=>e.name.toLowerCase().includes("idle")||e.name.toLowerCase().includes("standing")))||k[0];null===(e=I[t.name])||void 0===e||e.reset().fadeIn(.2).play()}return()=>{Object.values(I).forEach((e=>null===e||void 0===e?void 0:e.stop()))}}),[I,k]),(0,s.F)((e=>{const t=e.clock.getElapsedTime();let r=(0,n.A)({},f);if(m&&(r.pitch+=R.pitch,r.yaw+=R.yaw,r.roll+=R.roll),S.current){switch(S.current.rotation.x=.3,S.current.rotation.y=c.MathUtils.lerp(S.current.rotation.y,.7*r.yaw,.1),S.current.rotation.z=c.MathUtils.lerp(S.current.rotation.z,.3*r.roll,.1),b){case"happy":S.current.rotation.y+=.02*Math.sin(2*t);break;case"sad":S.current.rotation.y-=.1;break;case"excited":S.current.rotation.z+=.03*Math.sin(4*t);break;case"thoughtful":S.current.rotation.x+=.02*Math.sin(.5*t);break;case"angry":S.current.rotation.y-=.05;break;case"surprised":S.current.rotation.y+=.05}d&&(S.current.rotation.y+=Math.sin(8*t)*v*.03)}D.current&&(D.current.rotation.x=.3*r.pitch,D.current.rotation.y=.3*r.yaw),Object.entries(M.current).forEach((e=>{let[r,n]=e;if(!n.morphTargetDictionary||!n.morphTargetInfluences)return;Object.entries(g).forEach((e=>{let[t,r]=e;if(n.morphTargetDictionary&&n.morphTargetInfluences){const e=n.morphTargetDictionary[t];void 0!==e&&(n.morphTargetInfluences[e]=r||0)}})),Object.entries(y).forEach((e=>{let[t,r]=e;if(n.morphTargetDictionary&&n.morphTargetInfluences){const e=n.morphTargetDictionary["viseme_".concat(t)];void 0!==e&&(n.morphTargetInfluences[e]=r||0)}}));const a={happy:{mouthSmile:.7,eyeSquintLeft:.3,eyeSquintRight:.3},sad:{mouthFrownLeft:.5,mouthFrownRight:.5,eyesClosed:.2},angry:{browDownLeft:.8,browDownRight:.8,mouthFrownLeft:.3,mouthFrownRight:.3},surprised:{eyeWideLeft:.8,eyeWideRight:.8,mouthOpen:.5,browInnerUp:.7},thoughtful:{browDownLeft:.2,browDownRight:.2,mouthPucker:.2}};if(a[b]&&n.morphTargetDictionary&&n.morphTargetInfluences&&Object.entries(a[b]).forEach((e=>{let[t,r]=e;const a=n.morphTargetDictionary[t];void 0!==a&&(n.morphTargetInfluences[a]=Math.max(n.morphTargetInfluences[a],r))})),n.morphTargetDictionary&&n.morphTargetInfluences){const e=4,r=Math.sin(t*e)>.95?1:0,a=n.morphTargetDictionary.eyeBlinkLeft,o=n.morphTargetDictionary.eyeBlinkRight;void 0!==a&&(n.morphTargetInfluences[a]=r),void 0!==o&&(n.morphTargetInfluences[o]=r)}}))})),w?(0,l.jsx)("group",{position:u,scale:p,rotation:[.05,0,0],children:(0,l.jsx)("primitive",{object:w})}):null}},93807:(e,t,r)=>{r.r(t),r.d(t,{HumeAvatarIntegration:()=>s});var n=r(65043),a=r(33251),o=r(20770),i=r(70579);function s(e){let{avatarUrl:t,animationUrl:r,position:s=[0,-1,0],scale:c=[1.2,1.2,1.2],enableWebcamTracking:l=!1,isUser:u=!1}=e;const{messages:h}=(0,a.c0)(),[p,m]=(0,n.useState)({}),[f,g]=(0,n.useState)({}),[y,d]=(0,n.useState)("neutral"),[v,b]=(0,n.useState)(!1),[w,T]=(0,n.useState)(.5),[k,I]=(0,n.useState)({pitch:0,yaw:0,roll:0});return(0,n.useEffect)((()=>{if(!v)return void g({});const e=setInterval((()=>{const e=["aa","E","I","O","U","PP","FF","TH","DD","kk","CH","SS","nn","RR"],t={};t[e[Math.floor(Math.random()*e.length)]]=.6+.4*Math.random(),g(t)}),100);return()=>clearInterval(e)}),[v]),(0,n.useEffect)((()=>{var e,t;if(!h||0===h.length)return;const r=h[h.length-1];if("user_message"===r.type&&u?(b(!0),d("neutral"),T(.7)):"assistant_message"!==r.type||u?"user_interruption"!==r.type&&"assistant_end"!==r.type||b(!1):(b(!0),d("happy"),T(.6)),"models"in r&&null!==(e=r.models)&&void 0!==e&&null!==(t=e.prosody)&&void 0!==t&&t.scores){const e=r.models.prosody.scores,t=Object.entries(e).sort(((e,t)=>{let[,r]=e,[,n]=t;return n-r}));if(t.length>0){const[e]=t[0],r={Joy:"happy",Excitement:"excited",Sadness:"sad",Anger:"angry",Surprise:"surprised",Contemplation:"thoughtful"}[e];r&&d(r);const n={};t.forEach((e=>{let[t,r]=e;const a=t.toLowerCase();a&&"number"===typeof r&&(n[a]=r)})),m(n)}}}),[h,u]),(0,n.useEffect)((()=>{if(!v)return void I({pitch:0,yaw:0,roll:0});const e=setInterval((()=>{I({pitch:.1*(Math.random()-.5),yaw:.15*(Math.random()-.5),roll:.05*(Math.random()-.5)})}),500);return()=>clearInterval(e)}),[v]),(0,i.jsx)(o.RPMAvatarWithTracking,{avatarUrl:t,animationUrl:r,position:s,scale:c,enableWebcamTracking:l,headRotation:k,expressions:p,visemes:f,isSpeaking:v,voiceIntensity:w,emotionalState:y})}}}]);
//# sourceMappingURL=3807.5c253d8f.chunk.js.map