"use strict";(self.webpackChunkhub=self.webpackChunkhub||[]).push([[1211],{21211:(r,e,t)=>{t.r(e),t.d(e,{IdlePoseFullBodyAvatar:()=>s});var n=t(9950),o=t(13437),u=t(12880),l=t(69104),c=t(34973),i=t(44414);const s=r=>{let{avatarUrl:e,trackingData:t,postureData:s,position:a=[0,0,0],scale:h=1,debugMode:f=!0}=r;const d=(0,n.useRef)(null),{scene:m}=(0,l.p)(e),g=(0,n.useMemo)((()=>c.t.clone(m)),[m]),p=(0,n.useRef)(null),w=(0,n.useRef)(null),b=(0,n.useRef)(null),y=(0,n.useRef)(null),A=(0,n.useRef)(null),M=(0,n.useRef)(null),x=(0,n.useRef)(null),F=(0,n.useRef)(null),v=(0,n.useRef)(null),E=(0,n.useRef)({}),z=(0,n.useRef)({}),S=(0,n.useRef)({}),R=(0,n.useRef)(0);return(0,n.useEffect)((()=>{if(g&&(console.log("[IdlePoseFullBodyAvatar] Starting bone search..."),g.traverse((r=>{if(r instanceof o.Bone){const e=r.name.toLowerCase();console.log("[IdlePoseFullBodyAvatar] Found bone:",r.name),e.includes("head")&&!e.includes("headtop")&&(p.current=r),(e.includes("leftshoulder")||e.includes("shoulder_l"))&&(b.current=r),(e.includes("rightshoulder")||e.includes("shoulder_r"))&&(y.current=r),(e.includes("leftarm")||e.includes("arm_l")||e.includes("leftupperarm")||e.includes("upperarm_l"))&&!e.includes("fore")&&(A.current=r),(e.includes("rightarm")||e.includes("arm_r")||e.includes("rightupperarm")||e.includes("upperarm_r"))&&!e.includes("fore")&&(M.current=r),(e.includes("leftforearm")||e.includes("forearm_l")||e.includes("leftlowerarm")||e.includes("lowerarm_l"))&&(x.current=r),(e.includes("rightforearm")||e.includes("forearm_r")||e.includes("rightlowerarm")||e.includes("lowerarm_r"))&&(F.current=r),e.includes("neck")&&(w.current=r)}else r instanceof o.SkinnedMesh&&r.morphTargetDictionary&&(v.current=r)})),console.log("[IdlePoseFullBodyAvatar] Bone search complete:",{head:!!p.current,neck:!!w.current,leftShoulder:!!b.current,rightShoulder:!!y.current,leftArm:!!A.current,rightArm:!!M.current,leftForeArm:!!x.current,rightForeArm:!!F.current}),A.current&&(A.current.rotation.z=Math.PI/3,A.current.rotation.y=-Math.PI/8),M.current&&(M.current.rotation.z=-Math.PI/3,M.current.rotation.y=Math.PI/8),x.current&&(x.current.rotation.y=Math.PI/6),F.current&&(F.current.rotation.y=-Math.PI/6),setTimeout((()=>{A.current&&(E.current.leftArm=A.current.quaternion.clone(),z.current.leftArm=A.current.rotation.clone()),M.current&&(E.current.rightArm=M.current.quaternion.clone(),z.current.rightArm=M.current.rotation.clone()),x.current&&(E.current.leftForeArm=x.current.quaternion.clone(),z.current.leftForeArm=x.current.rotation.clone()),F.current&&(E.current.rightForeArm=F.current.quaternion.clone(),z.current.rightForeArm=F.current.rotation.clone()),console.log("[IdlePoseFullBodyAvatar] Stored idle pose rotations")}),100),f&&d.current)){const r={shoulder:16711680,elbow:65280,wrist:255};["leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist"].forEach((e=>{const t=new o.SphereGeometry(.05),n=e.includes("Shoulder")?r.shoulder:e.includes("Elbow")?r.elbow:r.wrist,u=new o.MeshBasicMaterial({color:n}),l=new o.Mesh(t,u);l.visible=!1,d.current.add(l),S.current[e]=l}))}}),[g,f]),(0,u.F)((()=>{if(R.current++,s&&s.keypoints){const r=s.keypoints,e=r.leftShoulder,t=r.leftElbow,n=r.leftWrist;if(e&&e.confidence>.05&&A.current)if(S.current.leftShoulder&&(S.current.leftShoulder.position.set(2*(e.x/640-.5),2*-(e.y/480-.5),0),S.current.leftShoulder.visible=!0),n&&n.confidence>.05){S.current.leftWrist&&(S.current.leftWrist.position.set(2*(n.x/640-.5),2*-(n.y/480-.5),0),S.current.leftWrist.visible=!0);const r=new o.Vector3(e.x/640-.5,-(e.y/480-.5),0).normalize(),u=new o.Vector3(n.x/640-.5,-(n.y/480-.5),-.2).normalize(),l=u.sub(r).normalize(),c=E.current.leftArm||new o.Quaternion,i=new o.Vector3(-.7,-.7,0).normalize(),s=(new o.Quaternion).setFromUnitVectors(i,l),a=c.clone().multiply(s);if(A.current.quaternion.slerp(a,.3),t&&t.confidence>.05&&x.current){S.current.leftElbow&&(S.current.leftElbow.position.set(2*(t.x/640-.5),2*-(t.y/480-.5),0),S.current.leftElbow.visible=!0);const e=new o.Vector3(t.x/640-.5,-(t.y/480-.5),-.1),n=e.clone().sub(r).normalize(),l=u.clone().sub(e).normalize(),c=Math.acos(Math.max(-1,Math.min(1,n.dot(l)))),i=E.current.leftForeArm||new o.Quaternion,s=(new o.Quaternion).setFromAxisAngle(new o.Vector3(0,0,-1),Math.min(.8*c,.8*Math.PI)),a=i.clone().multiply(s);x.current.quaternion.slerp(a,.3)}}else E.current.leftArm&&A.current.quaternion.slerp(E.current.leftArm,.1),x.current&&E.current.leftForeArm&&x.current.quaternion.slerp(E.current.leftForeArm,.1),S.current.leftWrist&&(S.current.leftWrist.visible=!1),S.current.leftElbow&&(S.current.leftElbow.visible=!1);const u=r.rightShoulder,l=r.rightElbow,c=r.rightWrist;if(u&&u.confidence>.05&&M.current)if(S.current.rightShoulder&&(S.current.rightShoulder.position.set(2*(u.x/640-.5),2*-(u.y/480-.5),0),S.current.rightShoulder.visible=!0),c&&c.confidence>.05){S.current.rightWrist&&(S.current.rightWrist.position.set(2*(c.x/640-.5),2*-(c.y/480-.5),0),S.current.rightWrist.visible=!0);const r=new o.Vector3(u.x/640-.5,-(u.y/480-.5),0).normalize(),e=new o.Vector3(c.x/640-.5,-(c.y/480-.5),-.2).normalize(),t=e.sub(r).normalize(),n=E.current.rightArm||new o.Quaternion,i=new o.Vector3(.7,-.7,0).normalize(),s=(new o.Quaternion).setFromUnitVectors(i,t),a=n.clone().multiply(s);if(M.current.quaternion.slerp(a,.3),l&&l.confidence>.05&&F.current){S.current.rightElbow&&(S.current.rightElbow.position.set(2*(l.x/640-.5),2*-(l.y/480-.5),0),S.current.rightElbow.visible=!0);const t=new o.Vector3(l.x/640-.5,-(l.y/480-.5),-.1),n=t.clone().sub(r).normalize(),u=e.clone().sub(t).normalize(),c=Math.acos(Math.max(-1,Math.min(1,n.dot(u)))),i=E.current.rightForeArm||new o.Quaternion,s=(new o.Quaternion).setFromAxisAngle(new o.Vector3(0,0,1),Math.min(.8*c,.8*Math.PI)),a=i.clone().multiply(s);F.current.quaternion.slerp(a,.3)}}else E.current.rightArm&&M.current.quaternion.slerp(E.current.rightArm,.1),F.current&&E.current.rightForeArm&&F.current.quaternion.slerp(E.current.rightForeArm,.1),S.current.rightWrist&&(S.current.rightWrist.visible=!1),S.current.rightElbow&&(S.current.rightElbow.visible=!1)}if(t&&t.headRotation&&p.current){const{pitch:r,yaw:e,roll:n}=t.headRotation,u=new o.Euler(.5*r,.7*e,.3*n,"XYZ");p.current.rotation.x=o.MathUtils.lerp(p.current.rotation.x,u.x,.1),p.current.rotation.y=o.MathUtils.lerp(p.current.rotation.y,u.y,.1),p.current.rotation.z=o.MathUtils.lerp(p.current.rotation.z,u.z,.1)}if(t&&t.expressions&&v.current){const r=v.current;r.morphTargetDictionary&&r.morphTargetInfluences&&Object.entries(t.expressions).forEach((e=>{let[t,n]=e;const o=r.morphTargetDictionary[t];void 0!==o&&(r.morphTargetInfluences[o]=n)}))}})),(0,i.jsx)("group",{ref:d,position:a,scale:h,children:g&&(0,i.jsx)("primitive",{object:g})})}}}]);