"use strict";(self.webpackChunkhub=self.webpackChunkhub||[]).push([[3529],{63529:(e,s,n)=>{n.r(s),n.d(s,{default:()=>g});var a=n(65043),t=n(4655),c=n(71985),o=n(9910),i=n(33251),r=n(39581),l=n(42708),d=n(8668),u=n(20213),h=(n(82358),n(70579));const m=e=>{let{coach:s,coachId:n}=e;const u=(0,t.Zp)(),{connect:m,disconnect:g,status:v,sendSessionSettings:f,messages:x}=(0,i.c0)(),[j,p]=(0,a.useState)(!1),[S,b]=(0,a.useState)(!1),[C,y]=(0,a.useState)({}),[k,N]=(0,a.useState)(new Uint8Array),[w,E]=(0,a.useState)(""),[A,F]=(0,a.useState)(""),[I,O]=(0,a.useState)(!1),[D,P]=(0,a.useState)(null),[T,H]=(0,a.useState)(null),[M,R]=(0,a.useState)(""),[U,K]=(0,a.useState)(null),[L,z]=(0,a.useState)(!1),W=(0,a.useRef)(null),_=(0,a.useRef)(null),J=(0,a.useRef)(null),V=((0,a.useRef)(null),"connected"===v.value);(0,a.useEffect)((()=>((async()=>{W.current||(W.current=new(window.AudioContext||window.webkitAudioContext),_.current=W.current.createAnalyser(),_.current.fftSize=256)})(),()=>{J.current&&cancelAnimationFrame(J.current)})),[]),(0,a.useEffect)((()=>((async()=>{try{console.log("[CoachSession] Requesting camera and microphone permissions...");const e=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});console.log("[CoachSession] Media permissions granted:",{video:e.getVideoTracks().length,audio:e.getAudioTracks().length}),K(e),z(!0)}catch(D){console.error("[CoachSession] Error accessing media devices:",D),P("Please allow camera and microphone access for the coach session")}})(),()=>{U&&U.getTracks().forEach((e=>e.stop()))})),[]),(0,a.useEffect)((()=>{L&&!V&&"disconnected"===v.value&&Y()}),[L,V,v.value]),(0,a.useEffect)((()=>{if(x.length>0){const n=x[x.length-1];var e;if("assistant_message"===n.type)E((null===(e=n.message)||void 0===e?void 0:e.content)||""),p(!0);else if("user_message"===n.type){var s;F((null===(s=n.message)||void 0===s?void 0:s.content)||""),b(!0)}}}),[x]);const Y=async()=>{try{O(!0),P(null),console.log("[CoachSession] Connecting to voice..."),await m(),console.log("[CoachSession] Connected successfully")}catch(e){console.error("[CoachSession] Failed to connect:",e),P(e.message||"Failed to connect to voice service")}finally{O(!1)}},q=async e=>{if(e.trim()&&V)try{console.log("[CoachSession] Message will be processed by Hume SDK:",e)}catch(s){console.error("Failed to send message:",s)}};return(0,h.jsxs)("div",{className:"coach-session",children:[(0,h.jsx)(d.MediaDebug,{}),(0,h.jsxs)("div",{className:"coach-header",children:[(0,h.jsxs)("h1",{children:["Coach Session: ",(null===s||void 0===s?void 0:s.name)||"Unknown Coach"]}),(0,h.jsx)("button",{onClick:()=>u("/coaches"),className:"back-button",children:"Back to Coaches"})]}),(0,h.jsxs)("div",{className:"session-container",children:[(0,h.jsx)("div",{className:"avatar-scene",children:(0,h.jsxs)(c.Hl,{camera:{position:[0,0,3],fov:45},style:{width:"100%",height:"100%"},children:[(0,h.jsx)(o.u,{makeDefault:!0,position:[0,0,3],fov:45}),(0,h.jsx)("ambientLight",{intensity:.5}),(0,h.jsx)("directionalLight",{position:[0,2,5],intensity:1}),(0,h.jsx)(a.Suspense,{fallback:null,children:(0,h.jsx)(r.PresenceAvatar,{audioData:j?k:void 0})})]})}),(0,h.jsx)("div",{className:"session-controls",children:V?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("div",{className:"conversation-status",children:[(0,h.jsxs)("p",{children:["Coach: ",w||"Waiting..."]}),(0,h.jsxs)("div",{className:"emotion-display",children:["Current Emotion: ",Object.entries(C).filter((e=>{let[s,n]=e;return n>.1})).map((e=>{let[s,n]=e;return"".concat(s,": ").concat((100*n).toFixed(0),"%")})).join(", ")||"Neutral"]})]}),(0,h.jsx)("div",{className:"user-section",children:(0,h.jsxs)("p",{children:["You: ",A||(S?"Listening...":"Not speaking")]})}),(0,h.jsxs)("div",{className:"message-input-section",children:[(0,h.jsx)("input",{type:"text",value:M,onChange:e=>R(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(q(M),R(""))},placeholder:"Type a message...",className:"message-input"}),(0,h.jsx)("button",{onClick:()=>{q(M),R("")},disabled:!M.trim(),className:"send-button",children:"Send"})]}),(0,h.jsx)("button",{onClick:async()=>{try{await g(),u("/coaches")}catch(e){console.error("Failed to disconnect:",e)}},className:"disconnect-button",children:"End Session"})]}):(0,h.jsxs)("div",{className:"connection-panel",children:[(0,h.jsx)("button",{onClick:Y,disabled:I,className:"connect-button",children:I?"Connecting...":"Start Session"}),D&&(0,h.jsx)("div",{className:"error-message",children:D})]})})]}),L&&U&&(0,h.jsx)(l.UserAvatarPiP,{avatarUrl:"/avatars/user_avatar.glb",position:"bottom-right",size:"medium",trackingData:T,enableOwnTracking:!0,cameraStream:U})]})},g=()=>{const{coachId:e}=(0,t.g)(),s=Object.values(u.r5),n=e?s.find((s=>s.id===e)):null,c=(0,a.useMemo)((()=>({type:"apiKey",value:"m3KaINwHsH55rJNO6zr2kIEAWvOimYeLTon3OriOXWJeCxCl"})),[]);if(!n)return(0,h.jsx)("div",{children:"Coach not found"});const o=(null===n||void 0===n?void 0:n.humeConfigId)||"bfd6db39-f0ea-46c3-a64b-e902d8cec212";return(0,h.jsx)(i.QP,{auth:c,configId:o,onError:e=>console.error("Hume Voice Error:",e),children:(0,h.jsx)(m,{coach:n,coachId:e||""})})}}}]);
//# sourceMappingURL=3529.4e997572.chunk.js.map