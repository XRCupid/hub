{"version":3,"file":"static/js/9322.30997777.chunk.js","mappings":"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","sources":["components/SimpleUserAvatarPiP.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState, memo } from 'react';\nimport { Canvas } from '@react-three/fiber';\nimport { OrbitControls } from '@react-three/drei';\nimport { Suspense } from 'react';\nimport { PresenceAvatar } from './PresenceAvatar';\nimport { CombinedFaceTrackingService } from '../services/CombinedFaceTrackingService';\nimport './UserAvatarPiP.css';\n\n// Simple error boundary\nclass ErrorBoundary extends React.Component<\n  { children: React.ReactNode },\n  { hasError: boolean; error: Error | null }\n> {\n  constructor(props: { children: React.ReactNode }) {\n    super(props);\n    this.state = { hasError: false, error: null };\n  }\n\n  static getDerivedStateFromError(error: Error) {\n    return { hasError: true, error };\n  }\n\n  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\n    console.error('Canvas error:', error, errorInfo);\n  }\n\n  render() {\n    if (this.state.hasError) {\n      return (\n        <div style={{ padding: '20px', color: 'red' }}>\n          <h3>Rendering Error</h3>\n          <p>{this.state.error?.message}</p>\n          <button onClick={() => window.location.reload()}>Reload</button>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n\n// Separate Canvas component to prevent re-renders\nconst AvatarCanvas = memo(({ \n  avatarUrl, \n  trackingData \n}: { \n  avatarUrl: string; \n  trackingData: any;\n}) => {\n  console.log('[AvatarCanvas] Rendering');\n  \n  return (\n    <Canvas \n      camera={{ \n        position: [0, 1.5, 2.0],\n        fov: 28,\n        near: 0.1,\n        far: 100\n      }}\n      style={{ width: '100%', height: '100%' }}\n      gl={{ preserveDrawingBuffer: true }}\n    >\n      <ambientLight intensity={0.6} />\n      <directionalLight position={[0, 10, 5]} intensity={0.8} />\n      <directionalLight position={[0, 5, 10]} intensity={0.5} />\n      \n      <Suspense fallback={null}>\n        <PresenceAvatar\n          avatarUrl={avatarUrl}\n          trackingData={trackingData}\n          position={[0, 0, 0]}\n          scale={1}\n        />\n      </Suspense>\n      \n      <OrbitControls \n        enablePan={false}\n        enableZoom={false}\n        enableRotate={false}\n        target={[0, 1.5, 0]}\n      />\n    </Canvas>\n  );\n});\n\ninterface SimpleUserAvatarPiPProps {\n  avatarUrl?: string;\n  onClose?: () => void;\n  position?: 'top-left' | 'top-right' | 'bottom-left' | 'bottom-right';\n  size?: 'small' | 'medium' | 'large';\n}\n\nexport const SimpleUserAvatarPiP: React.FC<SimpleUserAvatarPiPProps> = ({ \n  avatarUrl = '/avatars/coach_grace.glb',\n  onClose,\n  position = 'bottom-right',\n  size = 'medium'\n}) => {\n  const [isTracking, setIsTracking] = useState(false);\n  const [trackingData, setTrackingData] = useState<any>(null);\n  const [isMinimized, setIsMinimized] = useState(false);\n  const [error, setError] = useState<string>('');\n  \n  const videoRef = useRef<HTMLVideoElement>(null);\n  const trackingService = useRef<CombinedFaceTrackingService | null>(null);\n  const intervalRef = useRef<NodeJS.Timeout | null>(null);\n\n  useEffect(() => {\n    const initializeTracking = async () => {\n      try {\n        // Initialize tracking service\n        if (!trackingService.current) {\n          trackingService.current = new CombinedFaceTrackingService();\n          await trackingService.current.initialize();\n        }\n        \n        // Set up camera\n        const stream = await navigator.mediaDevices.getUserMedia({ \n          video: { \n            width: { ideal: 640 },\n            height: { ideal: 480 },\n            facingMode: 'user'\n          } \n        });\n        \n        if (videoRef.current) {\n          videoRef.current.srcObject = stream;\n          await videoRef.current.play();\n        }\n      } catch (err) {\n        console.error('Failed to initialize:', err);\n        setError('Failed to access camera');\n      }\n    };\n\n    initializeTracking();\n\n    return () => {\n      stopTracking();\n      if (videoRef.current?.srcObject) {\n        const stream = videoRef.current.srcObject as MediaStream;\n        stream.getTracks().forEach(track => track.stop());\n      }\n    };\n  }, []);\n\n  const startTracking = async () => {\n    if (!trackingService.current || !videoRef.current) return;\n    \n    setIsTracking(true);\n    setError('');\n    \n    try {\n      await trackingService.current.startTracking(videoRef.current);\n      \n      // Update tracking data at 30fps\n      intervalRef.current = setInterval(() => {\n        if (trackingService.current) {\n          const expressions = trackingService.current.getExpressions();\n          const headRotation = trackingService.current.getHeadRotation();\n          const landmarks = trackingService.current.getLandmarks();\n          \n          setTrackingData({\n            facialExpressions: expressions,\n            headRotation: headRotation,\n            posture: null,\n            hands: null,\n            landmarks: landmarks || []\n          });\n        }\n      }, 33); // ~30fps\n    } catch (err: any) {\n      console.error('Tracking error:', err);\n      setError(err.message || 'Failed to start tracking');\n      setIsTracking(false);\n    }\n  };\n\n  const stopTracking = () => {\n    if (intervalRef.current) {\n      clearInterval(intervalRef.current);\n      intervalRef.current = null;\n    }\n    \n    if (trackingService.current) {\n      trackingService.current.stopTracking();\n    }\n    \n    setIsTracking(false);\n  };\n\n  return (\n    <>\n      <video \n        ref={videoRef}\n        style={{ display: 'none' }}\n        playsInline\n        muted\n      />\n      \n      <div className={`user-avatar-pip ${position} ${size} ${isMinimized ? 'minimized' : ''}`}>\n        <div className=\"pip-controls\">\n          <button \n            className=\"pip-button\"\n            onClick={() => setIsMinimized(!isMinimized)}\n            title={isMinimized ? \"Restore\" : \"Minimize\"}\n          >\n            {isMinimized ? '□' : '_'}\n          </button>\n          {onClose && (\n            <button \n              className=\"pip-button\"\n              onClick={onClose}\n              title=\"Close\"\n            >\n              ×\n            </button>\n          )}\n        </div>\n        \n        {!isMinimized && (\n          <>\n            <div className=\"pip-content\" key=\"avatar-canvas-container\">\n              <ErrorBoundary>\n                <AvatarCanvas \n                  avatarUrl={avatarUrl}\n                  trackingData={trackingData}\n                />\n              </ErrorBoundary>\n              {error && (\n                <div className=\"error-message\" style={{\n                  position: 'absolute',\n                  top: '50%',\n                  left: '50%',\n                  transform: 'translate(-50%, -50%)',\n                  background: 'rgba(0,0,0,0.8)',\n                  padding: '20px',\n                  borderRadius: '8px'\n                }}>\n                  <p>{error}</p>\n                  <button onClick={() => window.location.reload()}>Refresh</button>\n                </div>\n              )}\n            </div>\n            \n            <div className=\"pip-footer\">\n              {!isTracking ? (\n                <button onClick={startTracking} className=\"control-button\">\n                  Start Camera & Tracking\n                </button>\n              ) : (\n                <button onClick={stopTracking} className=\"control-button active\">\n                  Stop Tracking\n                </button>\n              )}\n            </div>\n          </>\n        )}\n        \n        {trackingData?.facialExpressions && !error && (\n          <div className=\"expression-debug\">\n            <div className=\"expression-mini\">\n              {isTracking && <div style={{color: 'lime', fontSize: '10px'}}>● TRACKING</div>}\n              {Object.entries(trackingData.facialExpressions)\n                .filter(([_, value]) => (value as number) > 0.2)\n                .slice(0, 3)\n                .map(([name, value]) => (\n                  <div key={name} style={{ fontSize: '10px' }}>\n                    {name}: {((value as number) * 100).toFixed(0)}%\n                  </div>\n                ))}\n            </div>\n          </div>\n        )}\n      </div>\n    </>\n  );\n};\n"],"names":["ErrorBoundary","React","constructor","props","super","this","state","hasError","error","getDerivedStateFromError","componentDidCatch","errorInfo","console","render","_this$state$error","_jsxs","style","padding","color","children","_jsx","message","onClick","window","location","reload","AvatarCanvas","memo","_ref","avatarUrl","trackingData","log","Canvas","camera","position","fov","near","far","width","height","gl","preserveDrawingBuffer","intensity","Suspense","fallback","PresenceAvatar","scale","OrbitControls","enablePan","enableZoom","enableRotate","target","SimpleUserAvatarPiP","_ref2","onClose","size","isTracking","setIsTracking","useState","setTrackingData","isMinimized","setIsMinimized","setError","videoRef","useRef","trackingService","intervalRef","useEffect","async","current","CombinedFaceTrackingService","initialize","stream","navigator","mediaDevices","getUserMedia","video","ideal","facingMode","srcObject","play","err","initializeTracking","_videoRef$current","stopTracking","getTracks","forEach","track","stop","clearInterval","_Fragment","ref","display","playsInline","muted","className","concat","title","top","left","transform","background","borderRadius","startTracking","setInterval","expressions","getExpressions","headRotation","getHeadRotation","landmarks","getLandmarks","facialExpressions","posture","hands","fontSize","Object","entries","filter","_ref3","_","value","slice","map","_ref4","name","toFixed"],"sourceRoot":""}