{"version":3,"file":"static/js/5180.9104d79e.chunk.js","mappings":"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","sources":["components/CircularPiPAvatar.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect, Suspense } from 'react';\nimport { Canvas } from '@react-three/fiber';\nimport { OrbitControls } from '@react-three/drei';\nimport { PresenceAvatar } from './PresenceAvatar';\nimport { CombinedFaceTrackingService } from '../services/CombinedFaceTrackingService';\nimport type { TrackingData } from '../types/tracking';\n\ninterface CircularPiPAvatarProps {\n  position?: 'top-left' | 'top-right' | 'bottom-left' | 'bottom-right';\n  size?: number; // diameter in pixels\n  avatarUrl?: string;\n  enableOwnTracking?: boolean;\n  trackingData?: TrackingData; // Accept parent tracking data\n  onClose?: () => void;\n  cameraStream?: MediaStream | null;\n}\n\nexport const CircularPiPAvatar: React.FC<CircularPiPAvatarProps> = ({\n  position = 'bottom-right',\n  size = 200,\n  avatarUrl,\n  trackingData,\n  enableOwnTracking = false,\n  onClose,\n  cameraStream = null,\n  ...props\n}) => {\n  console.log('ðŸš¨ CircularPiPAvatar RENDER - enableOwnTracking:', enableOwnTracking);\n  \n  const [error, setError] = useState<string | null>(null);\n  const [isTracking, setIsTracking] = useState(false);\n  const [currentTrackingData, setCurrentTrackingData] = useState<TrackingData | null>(null);\n  \n  console.log('ðŸ”¥ CIRCULAR PIP AVATAR RENDER:', { \n    position, \n    size, \n    hasTrackingData: !!trackingData,\n    enableOwnTracking \n  });\n  \n  const videoRef = useRef<HTMLVideoElement | null>(null);\n  const streamRef = useRef<MediaStream | null>(null);\n  const trackingService = useRef<CombinedFaceTrackingService | null>(null);\n  const intervalRef = useRef<NodeJS.Timeout | null>(null);\n\n  console.log('ðŸŽ¥ CircularPiPAvatar mounted with enableOwnTracking:', enableOwnTracking);\n\n  // Component mount log\n  useEffect(() => {\n    console.log('ðŸš€ PiP component did mount, enableOwnTracking =', enableOwnTracking);\n  }, []);\n\n  // Set tracking status based on whether we have tracking data\n  useEffect(() => {\n    setIsTracking(!!trackingData?.facialExpressions);\n    console.log('ðŸ”´ PiP TRACKING DEBUG:', {\n      hasTrackingData: !!trackingData,\n      hasFacialExpressions: !!trackingData?.facialExpressions,\n      jawOpen: trackingData?.facialExpressions?.jawOpen,\n      trackingDataKeys: trackingData ? Object.keys(trackingData) : 'none'\n    });\n  }, [trackingData]);\n\n  // Debug tracking data\n  useEffect(() => {\n    console.log('ðŸŽ­ PiP Tracking state:', {\n      isTracking,\n      hasCurrentTrackingData: !!currentTrackingData,\n      hasPropsTrackingData: !!trackingData,\n      expressions: currentTrackingData?.facialExpressions,\n      enableOwnTracking\n    });\n  }, [isTracking, currentTrackingData, trackingData, enableOwnTracking]);\n\n  // Camera initialization for own tracking\n  useEffect(() => {\n    console.log('ðŸŽ¥ PiP useEffect triggered - enableOwnTracking:', enableOwnTracking);\n    console.log('ðŸŽ¥ PiP effect deps:', { enableOwnTracking, mounted: true });\n    \n    if (!enableOwnTracking) {\n      console.log('ðŸŽ¥ PiP own tracking disabled, using external tracking data');\n      return;\n    }\n    \n    console.log('ðŸŽ¥ PiP STARTING OWN CAMERA TRACKING...');\n    \n    let isMounted = true;\n    \n    const initializePiPTracking = async () => {\n      // Delay to avoid race conditions with main scene ML5 initialization\n      console.log('ðŸŽ¥ PiP delaying initialization to avoid ML5 conflicts...');\n      await new Promise(resolve => setTimeout(resolve, 2000)); // Increased from 1000ms to 2000ms\n      \n      if (!isMounted) {\n        console.log('ðŸŽ¥ PiP component unmounted during delay, aborting initialization');\n        return;\n      }\n      \n      console.log('ðŸŽ¥ PiP delay complete, proceeding with initialization...');\n      \n      const initCamera = async () => {\n        try {\n          console.log('ðŸŽ¥ PiP requesting camera permissions...');\n          const stream = await navigator.mediaDevices.getUserMedia({ \n            video: { \n              facingMode: 'user',\n              width: { ideal: 640 },\n              height: { ideal: 480 }\n            } \n          });\n          \n          console.log('ðŸŽ¥ PiP camera permissions granted, stream obtained:', {\n            active: stream.active,\n            tracks: stream.getTracks().length,\n            videoTracks: stream.getVideoTracks().length\n          });\n          \n          if (!isMounted) {\n            console.log('ðŸŽ¥ PiP component unmounted after getting stream, cleaning up');\n            stream.getTracks().forEach(track => track.stop());\n            return;\n          }\n          \n          streamRef.current = stream;\n          \n          // Create hidden video element\n          const video = document.createElement('video');\n          video.autoplay = true;\n          video.playsInline = true;\n          video.muted = true;\n          video.width = 640;\n          video.height = 480;\n          video.style.display = 'none';\n          video.style.position = 'absolute';\n          video.style.top = '-9999px';\n          document.body.appendChild(video);\n          videoRef.current = video;\n          \n          // Set video source after appending to DOM\n          video.srcObject = stream;\n          console.log('ðŸŽ¥ PiP video element created and stream attached');\n          \n          // Wait for video to be ready\n          await new Promise<void>((resolve) => {\n            console.log('ðŸŽ¥ PiP waiting for video metadata...');\n            const checkVideo = () => {\n              if (video.readyState >= 2) {\n                console.log('ðŸŽ¥ PiP video ready state:', video.readyState);\n                video.play().then(() => {\n                  console.log('ðŸŽ¥ PiP video playing');\n                  resolve();\n                }).catch(err => {\n                  console.error('ðŸŽ¥ PiP video play error:', err);\n                  resolve();\n                });\n              } else {\n                setTimeout(checkVideo, 100);\n              }\n            };\n            \n            video.onloadedmetadata = () => {\n              console.log('ðŸŽ¥ PiP video metadata loaded');\n              checkVideo();\n            };\n            \n            // Fallback if metadata never loads\n            setTimeout(() => {\n              console.warn('ðŸŽ¥ PiP video metadata timeout, forcing continue');\n              resolve();\n            }, 3000);\n          });\n          \n          // Initialize face tracking service\n          if (!trackingService.current) {\n            console.log('ðŸŽ¥ PiP creating tracking service...');\n            trackingService.current = CombinedFaceTrackingService.getInstance();\n            console.log('ðŸŽ¥ PiP tracking service created');\n          }\n          \n          // Start tracking\n          if (videoRef.current && trackingService.current) {\n            console.log('ðŸŽ¥ PiP starting face tracking...');\n            try {\n              await trackingService.current.startTracking(videoRef.current);\n              console.log('ðŸŽ¥ PiP FACE TRACKING STARTED SUCCESSFULLY');\n              setIsTracking(true);\n            } catch (err) {\n              console.error('ðŸŽ¥ PiP tracking initialization failed:', err);\n              throw err;\n            }\n            \n            // Start tracking loop\n            intervalRef.current = setInterval(() => {\n              if (trackingService.current) {\n                const expressions = trackingService.current.getExpressions();\n                if (expressions) {\n                  // Log every 2 seconds to avoid spam\n                  if (Date.now() % 2000 < 50) {\n                    console.log('ðŸŽ¥ PiP TRACKING DATA:', {\n                      jawOpen: expressions.jawOpen,\n                      mouthSmileLeft: expressions.mouthSmileLeft,\n                      mouthSmileRight: expressions.mouthSmileRight,\n                      browInnerUp: expressions.browInnerUp,\n                      eyeWideLeft: expressions.eyeWideLeft,\n                      eyeWideRight: expressions.eyeWideRight,\n                      hasAnyExpression: Object.values(expressions).some(v => v > 0)\n                    });\n                  }\n                  \n                  // Convert to TrackingData format\n                  const trackingData: TrackingData = {\n                    facialExpressions: expressions,\n                    headRotation: { pitch: 0, yaw: 0, roll: 0 }\n                  };\n                  setCurrentTrackingData(trackingData);\n                } else {\n                  console.warn('ðŸŽ¥ PiP: No expressions detected');\n                }\n              }\n            }, 50); // 20fps tracking\n          }\n          \n        } catch (error) {\n          console.error('ðŸŽ¥ PiP CAMERA ERROR:', error);\n          setError('Camera permission denied');\n          setIsTracking(false);\n        }\n      };\n      \n      initCamera();\n    };\n    \n    initializePiPTracking();\n    \n    // Cleanup function\n    return () => {\n      console.log('ðŸŽ¥ PiP cleaning up camera and tracking...');\n      isMounted = false;\n      \n      // Stop tracking\n      if (trackingService.current) {\n        trackingService.current.stopTracking();\n        trackingService.current = null;\n      }\n      \n      // Clear interval\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current);\n        intervalRef.current = null;\n      }\n      \n      // Stop and cleanup video\n      if (streamRef.current) {\n        streamRef.current.getTracks().forEach(track => track.stop());\n        streamRef.current = null;\n      }\n      \n      // Remove video element\n      if (videoRef.current) {\n        if (videoRef.current.parentNode) {\n          videoRef.current.parentNode.removeChild(videoRef.current);\n        }\n        videoRef.current = null;\n      }\n    };\n  }, [enableOwnTracking]); // Dependency on enableOwnTracking\n\n  // Cleanup on unmount  \n  useEffect(() => {\n    return () => {\n      console.log('ðŸ§¹ PiP CLEANUP STARTING...');\n      \n      if (intervalRef.current) {\n        clearInterval(intervalRef.current);\n        intervalRef.current = null;\n      }\n      \n      if (trackingService.current) {\n        trackingService.current.stopTracking();\n        trackingService.current = null;\n      }\n      \n      if (streamRef.current) {\n        streamRef.current.getTracks().forEach(track => track.stop());\n        streamRef.current = null;\n      }\n      \n      if (videoRef.current) {\n        // Just cleanup the video element - it was never added to DOM\n        try {\n          if (videoRef.current.srcObject) {\n            videoRef.current.srcObject = null;\n          }\n        } catch (error) {\n          console.warn('ðŸ§¹ Video srcObject cleanup warning:', error);\n        }\n        videoRef.current = null;\n      }\n      \n      console.log('ðŸ§¹ PiP CLEANUP COMPLETE');\n    };\n  }, []);\n\n  // Position styles\n  const getPositionStyle = () => {\n    const baseStyle = {\n      position: 'fixed' as const,\n      zIndex: 9999,\n      width: size,\n      height: size,\n    };\n\n    switch (position) {\n      case 'top-left':\n        return { ...baseStyle, top: '20px', left: '20px' };\n      case 'top-right':\n        return { ...baseStyle, top: '20px', right: '20px' };\n      case 'bottom-left':\n        return { ...baseStyle, bottom: '20px', left: '20px' };\n      case 'bottom-right':\n      default:\n        return { ...baseStyle, bottom: '20px', right: '20px' };\n    }\n  };\n\n  return (\n    <div\n      style={{\n        ...getPositionStyle(),\n        borderRadius: '50%', // Perfect circle\n        overflow: 'hidden',\n        border: '4px solid #ff69b4', // Bright pink border\n        background: 'rgba(0, 0, 0, 0.1)',\n        backdropFilter: 'blur(10px)',\n        boxShadow: '0 8px 32px rgba(255, 105, 180, 0.3)', // Pink glow\n      }}\n    >\n      {/* Close button */}\n      {onClose && (\n        <button\n          onClick={onClose}\n          style={{\n            position: 'absolute',\n            top: '8px',\n            right: '8px',\n            width: '24px',\n            height: '24px',\n            borderRadius: '50%',\n            background: 'rgba(0, 0, 0, 0.6)',\n            border: '1px solid rgba(255, 255, 255, 0.2)',\n            color: 'white',\n            cursor: 'pointer',\n            fontSize: '12px',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            zIndex: 10001\n          }}\n        >\n          âœ•\n        </button>\n      )}\n\n      {/* Status indicator */}\n      <div\n        style={{\n          position: 'absolute',\n          top: '8px',\n          left: '8px',\n          width: '12px',\n          height: '12px',\n          borderRadius: '50%',\n          background: isTracking ? '#4CAF50' : '#f44336',\n          border: '2px solid white',\n          zIndex: 10001\n        }}\n      />\n\n      {/* Error display */}\n      {error && (\n        <div\n          style={{\n            position: 'absolute',\n            top: '50%',\n            left: '50%',\n            transform: 'translate(-50%, -50%)',\n            color: 'white',\n            fontSize: '12px',\n            textAlign: 'center',\n            zIndex: 10001\n          }}\n        >\n          {error}\n        </div>\n      )}\n\n      {/* 3D Avatar Canvas */}\n      <Canvas\n        camera={{\n          position: [0, 1.6, 2.5], // Move camera back and at face height\n          fov: 20, // Very tight FOV for face zoom\n          near: 0.1,\n          far: 100\n        }}\n        style={{\n          width: '100%',\n          height: '100%',\n          borderRadius: '50%', // Circular canvas\n        }}\n      >\n        <ambientLight intensity={0.8} />\n        <directionalLight position={[2, 4, 2]} intensity={0.7} />\n        \n        <Suspense fallback={null}>\n          <PresenceAvatar\n            avatarUrl={avatarUrl}\n            position={[0, 0, 0]} // Reset to center position\n            scale={1} // Reset scale\n            trackingData={(() => {\n              const data = currentTrackingData || trackingData;\n              if (data && Date.now() % 2000 < 50) {\n                console.log('ðŸŽ­ PiP Passing to PresenceAvatar:', {\n                  hasData: !!data,\n                  hasFacialExpressions: !!data?.facialExpressions,\n                  sampleExpression: data?.facialExpressions?.jawOpen,\n                  allExpressions: data?.facialExpressions\n                });\n              }\n              return data;\n            })()}\n            animationName=\"idle\"\n          />\n        </Suspense>\n        \n        <OrbitControls\n          enablePan={false}\n          enableZoom={false}\n          enableRotate={false}\n          target={[0, 1.6, 0]} // Look at face height\n        />\n      </Canvas>\n    </div>\n  );\n};\n"],"names":["CircularPiPAvatar","_ref","position","size","avatarUrl","trackingData","enableOwnTracking","onClose","cameraStream","_objectWithoutProperties","_excluded","console","log","error","setError","useState","isTracking","setIsTracking","currentTrackingData","setCurrentTrackingData","hasTrackingData","videoRef","useRef","streamRef","trackingService","intervalRef","useEffect","_trackingData$facialE","facialExpressions","hasFacialExpressions","jawOpen","trackingDataKeys","Object","keys","hasCurrentTrackingData","hasPropsTrackingData","expressions","mounted","isMounted","async","Promise","resolve","setTimeout","stream","navigator","mediaDevices","getUserMedia","video","facingMode","width","ideal","height","active","tracks","getTracks","length","videoTracks","getVideoTracks","forEach","track","stop","current","document","createElement","autoplay","playsInline","muted","style","display","top","body","appendChild","srcObject","checkVideo","readyState","play","then","catch","err","onloadedmetadata","warn","CombinedFaceTrackingService","getInstance","startTracking","setInterval","getExpressions","Date","now","mouthSmileLeft","mouthSmileRight","browInnerUp","eyeWideLeft","eyeWideRight","hasAnyExpression","values","some","v","headRotation","pitch","yaw","roll","initCamera","initializePiPTracking","stopTracking","clearInterval","parentNode","removeChild","_jsxs","_objectSpread","getPositionStyle","baseStyle","zIndex","left","right","bottom","borderRadius","overflow","border","background","backdropFilter","boxShadow","children","_jsx","onClick","color","cursor","fontSize","alignItems","justifyContent","transform","textAlign","Canvas","camera","fov","near","far","intensity","Suspense","fallback","PresenceAvatar","scale","data","_data$facialExpressio","hasData","sampleExpression","allExpressions","animationName","OrbitControls","enablePan","enableZoom","enableRotate","target"],"sourceRoot":""}