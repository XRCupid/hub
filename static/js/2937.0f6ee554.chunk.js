"use strict";(self.webpackChunkhub=self.webpackChunkhub||[]).push([[2937],{52937:(e,t,n)=>{n.r(t),n.d(t,{default:()=>x});var s=n(65043),r=n(4655),o=n(71985),a=n(58430),i=n(39581),c=n(42708),l=n(44646),u=(n(19404),n(70579));const d="Dougie",g="320d816a-8dac-44e6-b59b-1c3d2b6b24d9",h="/avatars/Dougie.glb",p="A fun speed dating experience",x=()=>{const e=(0,r.Zp)(),[t,n]=(0,s.useState)(!1),[x,m]=(0,s.useState)({}),[v,f]=(0,s.useState)(new Uint8Array(128)),[S,b]=(0,s.useState)(""),[D,j]=(0,s.useState)(""),[y,w]=(0,s.useState)(!1),[k,A]=(0,s.useState)(null),[N,C]=(0,s.useState)(null),[R,z]=(0,s.useState)(""),[U,E]=(0,s.useState)(null),[I,q]=(0,s.useState)(!1),[M,T]=(0,s.useState)("idle"),[B,L]=(0,s.useState)({}),[P,H]=(0,s.useState)(!1),[F,O]=(0,s.useState)(!1),[Y,V]=(0,s.useState)([]),[G,J]=(0,s.useState)(!1),[K,Z]=(0,s.useState)(300),[Q,W]=(0,s.useState)(!1),X=(0,s.useRef)(null),$=(0,s.useRef)(null),_=(0,s.useRef)(null),ee=(0,s.useRef)(new Audio),te=(0,s.useRef)(!1),ne=(0,s.useRef)([]),se=(0,s.useRef)(!1),re=(0,s.useRef)(null);(0,s.useEffect)((()=>{(async()=>{X.current||(console.log("[DougieSpeedDate] Initializing HybridVoiceService..."),X.current=new a.Y,X.current.onAudio((e=>{console.log("[DougieSpeedDate] Audio received:",e.size),H(!0),T("talking"),ne.current.push(e),se.current||oe()})),X.current.onMessage((e=>{var t;console.log("[DougieSpeedDate] Message received:",e);const n="string"===typeof e?e:(null===e||void 0===e||null===(t=e.message)||void 0===t?void 0:t.content)||(null===e||void 0===e?void 0:e.content)||JSON.stringify(e);var s,r;if(n&&n.trim()&&(V((e=>[...e,{role:"assistant",content:n}])),b(n),null!==e&&void 0!==e&&null!==(s=e.models)&&void 0!==s&&null!==(r=s.prosody)&&void 0!==r&&r.scores)){const t=e.models.prosody.scores,n=Object.entries(t).map((e=>{let[t,n]=e;return{name:t.charAt(0).toUpperCase()+t.slice(1),score:n}})),s=(0,l.R)(n);L(s)}})),X.current.onAssistantEnd((()=>{console.log("[DougieSpeedDate] Assistant ended"),H(!1),T("idle")})),X.current.onUserMessage((e=>{console.log("[DougieSpeedDate] User message:",e),V((t=>[...t,{role:"user",content:e}])),j(e)})),X.current.onError((e=>{console.error("[DougieSpeedDate] Error:",e),A(e.message)})),console.log("[DougieSpeedDate] HybridVoiceService initialized successfully"))})()}),[]);const oe=()=>{if(0===ne.current.length)return se.current=!1,H(!1),void T("idle");console.log("[DougieSpeedDate] Playing audio from queue, queue length:",ne.current.length),se.current=!0;const e=ne.current.shift(),t=URL.createObjectURL(e);if(ee.current.src=t,!te.current)try{if(!$.current||"closed"===$.current.state){const e=window.AudioContext||window.webkitAudioContext;$.current=new e({sampleRate:48e3}),console.log("[DougieSpeedDate] Created new AudioContext")}"suspended"===$.current.state&&($.current.resume(),console.log("[DougieSpeedDate] Resumed AudioContext"));const e=$.current.createAnalyser();e.fftSize=256;$.current.createMediaElementSource(ee.current).connect(e),e.connect($.current.destination),_.current=e,te.current=!0,console.log("[DougieSpeedDate] Audio analyzer setup complete")}catch(k){console.error("[DougieSpeedDate] Error setting up audio analyzer:",k)}ee.current.play().then((()=>{console.log("[DougieSpeedDate] Audio playing successfully"),H(!0),T("talking")})).catch((e=>{console.error("[DougieSpeedDate] Error playing audio:",e),se.current=!1,H(!1),T("idle"),setTimeout((()=>oe()),100)})),ee.current.onended=()=>{console.log("[DougieSpeedDate] Audio playback ended"),URL.revokeObjectURL(t),se.current=!1,H(!1),T("idle"),setTimeout((()=>oe()),100)}};(0,s.useEffect)((()=>{if(!_.current)return;const e=()=>{if(_.current&&P){const e=new Uint8Array(_.current.frequencyBinCount);_.current.getByteFrequencyData(e),f(e)}requestAnimationFrame(e)};e()}),[P]);const ae=async()=>{J(!0),await(async()=>{try{w(!0);const e=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});E(e),q(!0),w(!1)}catch(e){console.error("Permission denied:",e),A("Camera and microphone permissions are required"),w(!1)}})(),await(async()=>{if(X.current)try{w(!0),X.current.setUseHumeForConversation(!0),await X.current.connect(g),O(!0),w(!1),setTimeout((()=>{var e;null===(e=X.current)||void 0===e||e.sendMessage("Hi! I'm Dougie. I'm excited to meet you! Tell me about yourself.")}),1e3)}catch(e){console.error("Connection failed:",e),A("Failed to connect to voice service"),w(!1)}})(),re.current=setInterval((()=>{Z((e=>e<=1?(ie(),0):e-1))}),1e3)},ie=()=>{re.current&&clearInterval(re.current),X.current&&X.current.disconnect(),W(!0)};return(0,s.useEffect)((()=>()=>{re.current&&clearInterval(re.current),X.current&&X.current.disconnect(),U&&U.getTracks().forEach((e=>e.stop()))}),[U]),G||Q?Q?(0,u.jsx)("div",{className:"dougie-speed-date",children:(0,u.jsxs)("div",{className:"date-report",children:[(0,u.jsx)("h1",{children:"Date Complete!"}),(0,u.jsxs)("p",{children:["Thanks for speed dating with ",d,"!"]}),(0,u.jsxs)("div",{className:"conversation-summary",children:[(0,u.jsx)("h3",{children:"Conversation Summary"}),Y.map(((e,t)=>(0,u.jsxs)("div",{className:"message ".concat(e.role),children:[(0,u.jsxs)("strong",{children:["user"===e.role?"You":d,":"]})," ",e.content]},t)))]}),(0,u.jsx)("button",{onClick:()=>e("/speed-date"),children:"Back to Speed Dating"})]})}):(0,u.jsxs)("div",{className:"dougie-speed-date",children:[(0,u.jsx)("div",{className:"absolute inset-0",style:{backgroundImage:"url(/Venues/GreatBistro.png)",backgroundSize:"cover",backgroundPosition:"center",zIndex:0}}),(0,u.jsx)("div",{className:"absolute inset-0",style:{zIndex:1},children:(0,u.jsxs)(o.Hl,{children:[(0,u.jsx)("ambientLight",{intensity:.8}),(0,u.jsx)("directionalLight",{position:[5,5,5],intensity:1.2}),(0,u.jsx)(s.Suspense,{fallback:null,children:(0,u.jsx)(i.PresenceAvatar,{avatarUrl:h,animationName:M,audioData:v,emotionalBlendshapes:B,position:[0,-1,0],scale:1.5})})]})}),(0,u.jsxs)("div",{className:"absolute inset-0 pointer-events-none",style:{zIndex:9999},children:[(0,u.jsxs)("div",{className:"absolute top-4 left-4 pointer-events-auto",style:{zIndex:1e4},children:[(0,u.jsx)("div",{className:"bg-black text-white px-8 py-6 rounded-2xl shadow-2xl border-4 border-white",children:(0,u.jsxs)("div",{className:"text-5xl font-bold text-center",children:[Math.floor(K/60),":",(K%60).toString().padStart(2,"0")]})}),(0,u.jsx)("button",{onClick:ie,className:"mt-4 w-full bg-red-600 hover:bg-red-700 text-white text-2xl font-bold px-8 py-6 rounded-2xl shadow-2xl border-4 border-white hover:scale-105 transition-all",style:{zIndex:1e4},children:"END DATE"})]}),S&&(0,u.jsx)("div",{className:"absolute bottom-20 left-1/2 transform -translate-x-1/2 bg-black/80 text-white p-4 rounded-xl max-w-lg pointer-events-auto",children:(0,u.jsx)("p",{children:S})}),k&&(0,u.jsx)("div",{className:"absolute top-20 left-1/2 transform -translate-x-1/2 bg-red-600 text-white p-4 rounded-xl pointer-events-auto",children:(0,u.jsx)("p",{children:k})})]}),F&&U&&(0,u.jsx)(c.UserAvatarPiP,{position:"top-right",size:"medium",trackingData:N})]}):(0,u.jsx)("div",{className:"dougie-speed-date",children:(0,u.jsxs)("div",{className:"pre-date-screen",children:[(0,u.jsxs)("h1",{children:["Speed Date with ",d]}),(0,u.jsx)("p",{children:p}),(0,u.jsxs)("div",{className:"date-rules",children:[(0,u.jsx)("h3",{children:"Speed Date Rules"}),(0,u.jsxs)("ul",{children:[(0,u.jsx)("li",{children:"Be yourself and have fun!"}),(0,u.jsx)("li",{children:"Ask questions and share stories"}),(0,u.jsx)("li",{children:"Keep it light and engaging"}),(0,u.jsx)("li",{children:"You have 5 minutes to make a connection"})]})]}),(0,u.jsx)("button",{className:"start-button",onClick:ae,children:"Start Your Date"})]})})}}}]);
//# sourceMappingURL=2937.0f6ee554.chunk.js.map