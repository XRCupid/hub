"use strict";(self.webpackChunkhub=self.webpackChunkhub||[]).push([[7588],{47588:(e,a,i)=>{i.r(a),i.d(a,{SimulationView:()=>b});var n=i(89379),o=(i(62285),i(65043)),t=i(19550),s=i(54778),l=i(33251),r=i(95107),d=i(48497),u=i(70579);d.a.reduce(((e,a)=>(e[a]=0,e)),{}),d.a.reduce(((e,a)=>("eyeBlinkLeft"!==a&&"eyeBlinkRight"!==a&&(e[a]=0),e)),{});const c=["/animations/M_Talking_Variations_001.glb","/animations/M_Talking_Variations_002.glb","/animations/M_Talking_Variations_003.glb","/animations/M_Talking_Variations_004.glb","/animations/M_Talking_Variations_005.glb","/animations/M_Talking_Variations_006.glb","/animations/M_Talking_Variations_007.glb","/animations/M_Talking_Variations_008.glb","/animations/M_Talking_Variations_009.glb","/animations/M_Talking_Variations_010.glb","/animations/talk.glb"],m=["/animations/M_Standing_Idle_001.glb","/animations/M_Standing_Idle_002.glb","/animations/M_Standing_Idle_Variations_001.glb","/animations/M_Standing_Idle_Variations_002.glb","/animations/M_Standing_Idle_Variations_003.glb","/animations/M_Standing_Idle_Variations_004.glb","/animations/M_Standing_Idle_Variations_005.glb","/animations/M_Standing_Idle_Variations_006.glb","/animations/M_Standing_Idle_Variations_007.glb","/animations/M_Standing_Idle_Variations_008.glb","/animations/M_Standing_Idle_Variations_009.glb","/animations/M_Standing_Idle_Variations_010.glb","/animations/idle.glb"],g={background:"rgba(0,0,0,0.5)",border:"1px solid white",borderRadius:"5px",padding:"8px 12px",color:"white",cursor:"pointer",fontSize:"0.9em",margin:"5px"},p=o.forwardRef(((e,a)=>{const[i,d]=(0,o.useState)((()=>({isMicOn:!1,isCameraOn:!0,isSoundOn:!0,isChatOpen:!1,messages:[],inputValue:"",isSpeaking:!1,isAzureAudioActive:!1,currentHumeEmotions:[],statusMessage:"Initializing...",humeVoiceName:"KARL",azureVoiceName:"en-US-AvaNeural",currentVisemeShapes:{},manualBlendshapes:{},simulationId:e.simulationId,simulationData:null,error:null,isSending:!1,avatarUrl:e.avatarModelUrl||"/bro.glb",isCameraEnabled:!0,isMicMuted:!1,showChat:!0,currentProsodyBlendshapes:{}}))),{messages:p,sendUserInput:b,readyState:x,isPlaying:h,disconnect:f,connect:_,status:A}=(0,l.c0)(),S=(0,o.useRef)(null),k=(0,o.useRef)(null),I=(0,o.useRef)(null);(0,o.useEffect)((()=>{if(i.simulationId){console.log("[SimulationViewInternal] useEffect: state.simulationId is: ".concat(i.simulationId,". Fetching data."));(async()=>{const e=(0,t.aU)(),a=(0,t.H9)(e,"simulations",i.simulationId);try{const e=await(0,t.x7)(a);if(e.exists()){const a=e.data();console.log("[SimulationViewInternal] Fetched simulation data:",a),d((e=>(0,n.A)((0,n.A)({},e),{},{simulationData:a,avatarUrl:a.avatarUrl||e.avatarUrl,error:null})))}else console.error("[SimulationViewInternal] No such simulation document! ID:",i.simulationId),d((e=>(0,n.A)((0,n.A)({},e),{},{error:"Simulation not found.",simulationData:null})))}catch(o){console.error("[SimulationViewInternal] Error fetching simulation document:",o),d((e=>(0,n.A)((0,n.A)({},e),{},{error:"Failed to fetch simulation data.",simulationData:null})))}})()}else console.log("[SimulationViewInternal] useEffect: state.simulationId is undefined. Clearing simulation data."),d((a=>(0,n.A)((0,n.A)({},a),{},{simulationData:null,avatarUrl:e.avatarModelUrl||"/bro.glb"})))}),[i.simulationId,e.avatarModelUrl]);const M=(0,o.useCallback)((e=>{d((a=>(0,n.A)((0,n.A)({},a),{},{error:"Avatar error: "+((null===e||void 0===e?void 0:e.message)||e)})))}),[]),V=(0,o.useCallback)((()=>{}),[]),v=(0,o.useCallback)(((e,a)=>{d((a=>(0,n.A)((0,n.A)({},a),{},{statusMessage:'Viseme test triggered for "'.concat(e,'"')})))}),[]),y=(0,o.useCallback)((e=>{e.preventDefault(),d((e=>(0,n.A)((0,n.A)({},e),{},{statusMessage:"Message sent!"})))}),[]),C=(0,o.useCallback)((e=>{d((a=>(0,n.A)((0,n.A)({},a),{},{inputValue:e.target.value})))}),[]),w=(0,o.useCallback)((()=>{d((e=>(0,n.A)((0,n.A)({},e),{},{showChat:!e.showChat})))}),[]),E=(0,o.useCallback)((()=>{d((e=>(0,n.A)((0,n.A)({},e),{},{isMicMuted:!e.isMicMuted})))}),[]),j=(0,o.useCallback)((()=>{d((e=>(0,n.A)((0,n.A)({},e),{},{isSoundOn:!e.isSoundOn})))}),[]),T=(0,o.useCallback)((()=>{d((e=>(0,n.A)((0,n.A)({},e),{},{isSpeaking:!1,isAzureAudioActive:!1})))}),[]),U=(0,o.useCallback)((()=>{d((e=>(0,n.A)((0,n.A)({},e),{},{isAzureAudioActive:!1})))}),[]),H=(0,o.useCallback)((()=>{d((e=>(0,n.A)((0,n.A)({},e),{},{error:"Azure audio error"})))}),[]),O=i.isSpeaking||i.isAzureAudioActive||h;return console.log("Rendering avatar with URL:",i.avatarUrl),(0,u.jsxs)("div",{style:{display:"flex",flexDirection:"row",height:"100%",position:"relative"},children:[(0,u.jsx)(r.default,{ref:S,avatarUrl:i.avatarUrl,isSpeaking:O,detectedEmotions:i.currentHumeEmotions,visemeData:i.currentVisemeShapes,directBlendshapes:i.currentProsodyBlendshapes,cameraEnabled:i.isCameraEnabled,talkAnimationPaths:c,idleAnimationPaths:m,onError:M,onLoad:V},i.avatarUrl),(0,u.jsx)("button",{onClick:()=>v("Hello world, this is a test.",i.azureVoiceName||"en-US-JennyNeural"),style:(0,n.A)((0,n.A)({},g),{},{position:"absolute",top:"10px",left:"10px",zIndex:10}),children:"Test Visemes"}),i.showChat&&(0,u.jsxs)("div",{className:"chat-ui",style:{width:"350px",minWidth:"300px",background:"rgba(30, 33, 40, 0.95)",color:"white",display:"flex",flexDirection:"column",padding:"15px",borderLeft:"1px solid #4f5461",boxSizing:"border-box",position:"absolute",right:0,top:0,bottom:0,zIndex:5,transition:"transform 0.3s ease-in-out",transform:"translateX(0%)"},children:[(0,u.jsxs)("div",{className:"messages-area",style:{flexGrow:1,overflowY:"auto",marginBottom:"15px",paddingRight:"10px"},children:[i.messages.map((e=>(0,u.jsxs)("div",{className:"message ".concat(e.sender),style:{marginBottom:"12px",padding:"10px 15px",borderRadius:"18px",maxWidth:"85%",alignSelf:"user"===e.sender?"flex-end":"flex-start",background:"user"===e.sender?"#007bff":"#495057",color:"white",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",wordWrap:"break-word",fontSize:"0.95em"},children:[e.text,e.emotion&&(0,u.jsxs)("em",{style:{fontSize:"0.8em",display:"block",opacity:.7,marginTop:"4px"},children:["(",e.emotion,")"]})]},e.id))),(0,u.jsx)("div",{ref:k})]}),(0,u.jsx)("audio",{ref:I,onEnded:U,onError:H,style:{display:"none"}}),(0,u.jsxs)("form",{onSubmit:y,style:{display:"flex",marginTop:"auto",paddingTop:"10px",borderTop:"1px solid #4f5461",flexShrink:0},children:[(0,u.jsx)("input",{type:"text",placeholder:"Type your message...",value:i.inputValue,onChange:C,style:{flex:1,padding:"10px",borderRadius:"8px",border:"none",outline:"none",marginRight:"8px",background:"#343a40",color:"white"}}),(0,u.jsx)("button",{type:"submit",style:(0,n.A)((0,n.A)({},g),{},{background:"#007bff",margin:0}),children:(0,u.jsx)(s.Cer,{})})]})]}),!i.showChat&&(0,u.jsx)("button",{onClick:w,style:{position:"absolute",bottom:"30px",right:"30px",background:"#007bff",color:"white",border:"none",borderRadius:"50%",width:"60px",height:"60px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",zIndex:10,transition:"transform 0.2s ease"},onMouseOver:e=>e.currentTarget.style.transform="scale(1.1)",onMouseOut:e=>e.currentTarget.style.transform="scale(1)",children:"Chat"}),(0,u.jsxs)("div",{className:"controls-bar",style:{display:"flex",justifyContent:"center",alignItems:"center",padding:"10px",background:"#20232a",flexShrink:0,gap:"10px"},children:[(0,u.jsxs)("button",{onClick:E,style:g,title:i.isMicMuted?"Unmute Microphone":"Mute Microphone",children:[i.isMicMuted?(0,u.jsx)(s.$j$,{}):(0,u.jsx)(s.i0t,{})," ",i.isMicMuted?"Mic Off":"Mic On"]}),(0,u.jsxs)("button",{onClick:j,style:g,title:i.isSoundOn?"Mute Sound":"Unmute Sound",children:[i.isSoundOn?(0,u.jsx)(s.pPd,{}):(0,u.jsx)(s.FZ2,{})," ",i.isSoundOn?"Sound On":"Sound Off"]}),(0,u.jsxs)("button",{onClick:T,style:(0,n.A)((0,n.A)({},g),{},{background:"#dc3545"}),title:"Force stop all audio and speech",children:[(0,u.jsx)(s.mal,{})," Stop All Audio"]})]})]})})),b=e=>{const[a,i]=(0,o.useState)("Hume Audio: Idle"),n=(0,o.useRef)(null),t=o.useMemo((()=>{const e="m3KaINwHsH55rJNO6zr2kIEAWvOimYeLTon3OriOXWJeCxCl";return e||""}),[]),s="9c6f9d9b-1699-41bb-b335-9925bba5d6d9",r=(0,o.useCallback)((()=>{console.log("[Hume EVI] Connection opened via VoiceProvider.")}),[]),d=(0,o.useMemo)((()=>({type:"apiKey",value:t})),[t]),c=(0,o.useCallback)((e=>{const a=e.type;switch(console.log("[Hume EVI] Message received - Type: ".concat(a)),a){case"assistant_message":if(console.log("[Hume EVI] Assistant Message details:",e),e.models){const a=e.models;a.face&&a.face.predictions&&console.log("[Hume EVI] Face model predictions:",a.face.predictions)}break;case"user_interruption":console.log("[Hume EVI] User Interruption details:",e);break;case"tool_call":console.log("[Hume EVI] Tool Call details:",e);break;case"tool_response":console.log("[Hume EVI] Tool Response details:",e);break;case"tool_error":console.error("[Hume EVI] Tool Error details:",e)}}),[]),m=(0,o.useCallback)((e=>{var a;console.log("[Hume EVI] Connection closed via VoiceProvider. Code:",e.code,"Reason:",e.reason,"WasClean:",e.wasClean),null===(a=n.current)||void 0===a||a.forceStopHumeSpeaking()}),[]),g=(0,o.useCallback)((e=>{let a="[Hume EVI] VoiceProvider error - Type: ".concat(e.type,", Code: ").concat(e.code,", Message: ").concat(e.message);console.error(a,e)}),[]);return t||console.warn("[SimulationView] Hume API Key is not available. VoiceProvider will likely fail to connect."),console.log('[SimulationView] Attempting to connect VoiceProvider with API Key: "'.concat(t,'" and Config ID: "').concat(s,'"')),console.log("[SimulationView] voiceAuth object being passed:",d),(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{style:{padding:"8px",backgroundColor:"#ff69b4",color:"white",textAlign:"center",fontWeight:"bold",fontSize:"1.1em",zIndex:9999,position:"relative"},children:["HUME AUDIO EVENT STATUS: ",a]}),(0,u.jsx)(l.QP,{onAudioStart:()=>{console.log("[Hume EVI VoiceProvider] onAudioStart triggered"),i("Hume Audio: STARTED")},onAudioEnd:()=>{console.log("[Hume EVI VoiceProvider] onAudioEnd triggered"),i("Hume Audio: ENDED")},auth:d,configId:s,debug:!0,onOpen:r,onMessage:c,onClose:m,onError:g,children:(0,u.jsx)(p,{ref:n,avatarModelUrl:e.avatarModelUrl,simulationId:e.simulationId,humeConfigId:s})})]})}}}]);
//# sourceMappingURL=7588.797b4eab.chunk.js.map