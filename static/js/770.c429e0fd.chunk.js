"use strict";(self.webpackChunkhub=self.webpackChunkhub||[]).push([[770],{20770:(e,t,r)=>{r.r(t),r.d(t,{RPMAvatarWithTracking:()=>l});var n=r(89379),o=r(65043),a=r(81597),i=r(5355),c=r(79183),s=r(29408),u=r(70579);const l=e=>{let{avatarUrl:t,animationUrl:r,position:l=[0,-.4,0],rotation:h=[0,0,0],scale:p=[1.2,1.2,1.2],enableWebcamTracking:f=!1,headRotation:m={pitch:0,yaw:0,roll:0},expressions:g={},visemes:y={},isSpeaking:d=!1,voiceIntensity:b=0,emotionalState:w="neutral"}=e;const{scene:T}=(0,a.p)(t),k=(0,a.p)(r||t),v=r?k.animations:[],{actions:D}=(0,i.f)(v,T),I=(0,o.useRef)(null),R=(0,o.useRef)(null),L=(0,o.useRef)({}),M={pitch:0,yaw:0,roll:0},E=!1,j=null;return(0,o.useEffect)((()=>{f&&(console.log("Webcam tracking enabled:",E),j&&console.error("Webcam error:",j))}),[f,E,j]),(0,o.useEffect)((()=>{T&&T.traverse((e=>{if(e instanceof s.Bone){const t=e.name.toLowerCase();t.includes("head")?I.current=e:t.includes("neck")&&(R.current=e)}e instanceof s.SkinnedMesh&&e.morphTargetDictionary&&(L.current[e.name]=e)}))}),[T]),(0,o.useEffect)((()=>{if(D&&v.length>0){var e;const t=v.find((e=>e.name.toLowerCase().includes("idle")||e.name.toLowerCase().includes("standing")))||v[0];null===(e=D[t.name])||void 0===e||e.reset().fadeIn(.2).play()}return()=>{Object.values(D).forEach((e=>null===e||void 0===e?void 0:e.stop()))}}),[D,v]),(0,c.F)((e=>{const t=e.clock.getElapsedTime();let r=(0,n.A)({},m);if(f&&(r.pitch+=M.pitch,r.yaw+=M.yaw,r.roll+=M.roll),I.current){switch(I.current.rotation.x=.3,I.current.rotation.y=s.MathUtils.lerp(I.current.rotation.y,.7*r.yaw,.1),I.current.rotation.z=s.MathUtils.lerp(I.current.rotation.z,.3*r.roll,.1),w){case"happy":I.current.rotation.y+=.02*Math.sin(2*t);break;case"sad":I.current.rotation.y-=.1;break;case"excited":I.current.rotation.z+=.03*Math.sin(4*t);break;case"thoughtful":I.current.rotation.x+=.02*Math.sin(.5*t);break;case"angry":I.current.rotation.y-=.05;break;case"surprised":I.current.rotation.y+=.05}d&&(I.current.rotation.y+=Math.sin(8*t)*b*.03)}R.current&&(R.current.rotation.x=.3*r.pitch,R.current.rotation.y=.3*r.yaw),Object.entries(L.current).forEach((e=>{let[r,n]=e;if(!n.morphTargetDictionary||!n.morphTargetInfluences)return;Object.entries(g).forEach((e=>{let[t,r]=e;if(n.morphTargetDictionary&&n.morphTargetInfluences){const e=n.morphTargetDictionary[t];void 0!==e&&(n.morphTargetInfluences[e]=r||0)}})),Object.entries(y).forEach((e=>{let[t,r]=e;if(n.morphTargetDictionary&&n.morphTargetInfluences){const e=n.morphTargetDictionary["viseme_".concat(t)];void 0!==e&&(n.morphTargetInfluences[e]=r||0)}}));const o={happy:{mouthSmile:.7,eyeSquintLeft:.3,eyeSquintRight:.3},sad:{mouthFrownLeft:.5,mouthFrownRight:.5,eyesClosed:.2},angry:{browDownLeft:.8,browDownRight:.8,mouthFrownLeft:.3,mouthFrownRight:.3},surprised:{eyeWideLeft:.8,eyeWideRight:.8,mouthOpen:.5,browInnerUp:.7},thoughtful:{browDownLeft:.2,browDownRight:.2,mouthPucker:.2}};if(o[w]&&n.morphTargetDictionary&&n.morphTargetInfluences&&Object.entries(o[w]).forEach((e=>{let[t,r]=e;const o=n.morphTargetDictionary[t];void 0!==o&&(n.morphTargetInfluences[o]=Math.max(n.morphTargetInfluences[o],r))})),n.morphTargetDictionary&&n.morphTargetInfluences){const e=4,r=Math.sin(t*e)>.95?1:0,o=n.morphTargetDictionary.eyeBlinkLeft,a=n.morphTargetDictionary.eyeBlinkRight;void 0!==o&&(n.morphTargetInfluences[o]=r),void 0!==a&&(n.morphTargetInfluences[a]=r)}}))})),T?(0,u.jsx)("group",{position:l,scale:p,rotation:[.05,0,0],children:(0,u.jsx)("primitive",{object:T})}):null}}}]);
//# sourceMappingURL=770.c429e0fd.chunk.js.map