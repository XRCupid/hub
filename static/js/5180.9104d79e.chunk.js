"use strict";(self.webpackChunkhub=self.webpackChunkhub||[]).push([[5180],{25180:(e,t,n)=>{n.r(t),n.d(t,{CircularPiPAvatar:()=>g});var o=n(89379),i=n(53986),r=n(65043),a=n(71985),l=n(50007),s=n(39581),c=n(25021),u=n(70579);const d=["position","size","avatarUrl","trackingData","enableOwnTracking","onClose","cameraStream"],g=e=>{let{position:t="bottom-right",size:n=200,avatarUrl:g,trackingData:p,enableOwnTracking:P=!1,onClose:h,cameraStream:f=null}=e;(0,i.A)(e,d);console.log("\ud83d\udea8 CircularPiPAvatar RENDER - enableOwnTracking:",P);const[m,x]=(0,r.useState)(null),[b,v]=(0,r.useState)(!1),[w,k]=(0,r.useState)(null);console.log("\ud83d\udd25 CIRCULAR PIP AVATAR RENDER:",{position:t,size:n,hasTrackingData:!!p,enableOwnTracking:P});const T=(0,r.useRef)(null),A=(0,r.useRef)(null),E=(0,r.useRef)(null),y=(0,r.useRef)(null);console.log("\ud83c\udfa5 CircularPiPAvatar mounted with enableOwnTracking:",P),(0,r.useEffect)((()=>{console.log("\ud83d\ude80 PiP component did mount, enableOwnTracking =",P)}),[]),(0,r.useEffect)((()=>{var e;v(!(null===p||void 0===p||!p.facialExpressions)),console.log("\ud83d\udd34 PiP TRACKING DEBUG:",{hasTrackingData:!!p,hasFacialExpressions:!(null===p||void 0===p||!p.facialExpressions),jawOpen:null===p||void 0===p||null===(e=p.facialExpressions)||void 0===e?void 0:e.jawOpen,trackingDataKeys:p?Object.keys(p):"none"})}),[p]),(0,r.useEffect)((()=>{console.log("\ud83c\udfad PiP Tracking state:",{isTracking:b,hasCurrentTrackingData:!!w,hasPropsTrackingData:!!p,expressions:null===w||void 0===w?void 0:w.facialExpressions,enableOwnTracking:P})}),[b,w,p,P]),(0,r.useEffect)((()=>{if(console.log("\ud83c\udfa5 PiP useEffect triggered - enableOwnTracking:",P),console.log("\ud83c\udfa5 PiP effect deps:",{enableOwnTracking:P,mounted:!0}),!P)return void console.log("\ud83c\udfa5 PiP own tracking disabled, using external tracking data");console.log("\ud83c\udfa5 PiP STARTING OWN CAMERA TRACKING...");let e=!0;return(async()=>{if(console.log("\ud83c\udfa5 PiP delaying initialization to avoid ML5 conflicts..."),await new Promise((e=>setTimeout(e,2e3))),!e)return void console.log("\ud83c\udfa5 PiP component unmounted during delay, aborting initialization");console.log("\ud83c\udfa5 PiP delay complete, proceeding with initialization...");(async()=>{try{console.log("\ud83c\udfa5 PiP requesting camera permissions...");const n=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:640},height:{ideal:480}}});if(console.log("\ud83c\udfa5 PiP camera permissions granted, stream obtained:",{active:n.active,tracks:n.getTracks().length,videoTracks:n.getVideoTracks().length}),!e)return console.log("\ud83c\udfa5 PiP component unmounted after getting stream, cleaning up"),void n.getTracks().forEach((e=>e.stop()));A.current=n;const o=document.createElement("video");if(o.autoplay=!0,o.playsInline=!0,o.muted=!0,o.width=640,o.height=480,o.style.display="none",o.style.position="absolute",o.style.top="-9999px",document.body.appendChild(o),T.current=o,o.srcObject=n,console.log("\ud83c\udfa5 PiP video element created and stream attached"),await new Promise((e=>{console.log("\ud83c\udfa5 PiP waiting for video metadata...");const t=()=>{o.readyState>=2?(console.log("\ud83c\udfa5 PiP video ready state:",o.readyState),o.play().then((()=>{console.log("\ud83c\udfa5 PiP video playing"),e()})).catch((t=>{console.error("\ud83c\udfa5 PiP video play error:",t),e()}))):setTimeout(t,100)};o.onloadedmetadata=()=>{console.log("\ud83c\udfa5 PiP video metadata loaded"),t()},setTimeout((()=>{console.warn("\ud83c\udfa5 PiP video metadata timeout, forcing continue"),e()}),3e3)})),E.current||(console.log("\ud83c\udfa5 PiP creating tracking service..."),E.current=c.L.getInstance(),console.log("\ud83c\udfa5 PiP tracking service created")),T.current&&E.current){console.log("\ud83c\udfa5 PiP starting face tracking...");try{await E.current.startTracking(T.current),console.log("\ud83c\udfa5 PiP FACE TRACKING STARTED SUCCESSFULLY"),v(!0)}catch(t){throw console.error("\ud83c\udfa5 PiP tracking initialization failed:",t),t}y.current=setInterval((()=>{if(E.current){const e=E.current.getExpressions();if(e){Date.now()%2e3<50&&console.log("\ud83c\udfa5 PiP TRACKING DATA:",{jawOpen:e.jawOpen,mouthSmileLeft:e.mouthSmileLeft,mouthSmileRight:e.mouthSmileRight,browInnerUp:e.browInnerUp,eyeWideLeft:e.eyeWideLeft,eyeWideRight:e.eyeWideRight,hasAnyExpression:Object.values(e).some((e=>e>0))});k({facialExpressions:e,headRotation:{pitch:0,yaw:0,roll:0}})}else console.warn("\ud83c\udfa5 PiP: No expressions detected")}}),50)}}catch(m){console.error("\ud83c\udfa5 PiP CAMERA ERROR:",m),x("Camera permission denied"),v(!1)}})()})(),()=>{console.log("\ud83c\udfa5 PiP cleaning up camera and tracking..."),e=!1,E.current&&(E.current.stopTracking(),E.current=null),y.current&&(clearInterval(y.current),y.current=null),A.current&&(A.current.getTracks().forEach((e=>e.stop())),A.current=null),T.current&&(T.current.parentNode&&T.current.parentNode.removeChild(T.current),T.current=null)}}),[P]),(0,r.useEffect)((()=>()=>{if(console.log("\ud83e\uddf9 PiP CLEANUP STARTING..."),y.current&&(clearInterval(y.current),y.current=null),E.current&&(E.current.stopTracking(),E.current=null),A.current&&(A.current.getTracks().forEach((e=>e.stop())),A.current=null),T.current){try{T.current.srcObject&&(T.current.srcObject=null)}catch(m){console.warn("\ud83e\uddf9 Video srcObject cleanup warning:",m)}T.current=null}console.log("\ud83e\uddf9 PiP CLEANUP COMPLETE")}),[]);return(0,u.jsxs)("div",{style:(0,o.A)((0,o.A)({},(()=>{const e={position:"fixed",zIndex:9999,width:n,height:n};switch(t){case"top-left":return(0,o.A)((0,o.A)({},e),{},{top:"20px",left:"20px"});case"top-right":return(0,o.A)((0,o.A)({},e),{},{top:"20px",right:"20px"});case"bottom-left":return(0,o.A)((0,o.A)({},e),{},{bottom:"20px",left:"20px"});default:return(0,o.A)((0,o.A)({},e),{},{bottom:"20px",right:"20px"})}})()),{},{borderRadius:"50%",overflow:"hidden",border:"4px solid #ff69b4",background:"rgba(0, 0, 0, 0.1)",backdropFilter:"blur(10px)",boxShadow:"0 8px 32px rgba(255, 105, 180, 0.3)"}),children:[h&&(0,u.jsx)("button",{onClick:h,style:{position:"absolute",top:"8px",right:"8px",width:"24px",height:"24px",borderRadius:"50%",background:"rgba(0, 0, 0, 0.6)",border:"1px solid rgba(255, 255, 255, 0.2)",color:"white",cursor:"pointer",fontSize:"12px",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10001},children:"\u2715"}),(0,u.jsx)("div",{style:{position:"absolute",top:"8px",left:"8px",width:"12px",height:"12px",borderRadius:"50%",background:b?"#4CAF50":"#f44336",border:"2px solid white",zIndex:10001}}),m&&(0,u.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",fontSize:"12px",textAlign:"center",zIndex:10001},children:m}),(0,u.jsxs)(a.Hl,{camera:{position:[0,1.6,2.5],fov:20,near:.1,far:100},style:{width:"100%",height:"100%",borderRadius:"50%"},children:[(0,u.jsx)("ambientLight",{intensity:.8}),(0,u.jsx)("directionalLight",{position:[2,4,2],intensity:.7}),(0,u.jsx)(r.Suspense,{fallback:null,children:(0,u.jsx)(s.PresenceAvatar,{avatarUrl:g,position:[0,0,0],scale:1,trackingData:(()=>{const e=w||p;var t;e&&Date.now()%2e3<50&&console.log("\ud83c\udfad PiP Passing to PresenceAvatar:",{hasData:!!e,hasFacialExpressions:!(null===e||void 0===e||!e.facialExpressions),sampleExpression:null===e||void 0===e||null===(t=e.facialExpressions)||void 0===t?void 0:t.jawOpen,allExpressions:null===e||void 0===e?void 0:e.facialExpressions});return e})(),animationName:"idle"})}),(0,u.jsx)(l.N,{enablePan:!1,enableZoom:!1,enableRotate:!1,target:[0,1.6,0]})]})]})}}}]);
//# sourceMappingURL=5180.9104d79e.chunk.js.map